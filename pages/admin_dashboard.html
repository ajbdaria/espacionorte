<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Espacio Norte â€” Admin Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,600;0,700;1,600&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ESPACIO NORTE ADMIN â€” Full Dashboard
   Professional warm palette, Plus Jakarta Sans
   for crystal-clear readability at all sizes.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root{
  --forest:    #2B4A1A;
  --forest-dk: #1A2E10;
  --sage:      #4A7A2E;
  --sage-lt:   #72B048;
  --amber:     #C8932A;
  --gold:      #DBA84A;
  --gold-pale: #F5E4B8;
  --linen:     #F5EFE2;
  --parch:     #EDE0C8;
  --snow:      #FDFAF6;
  --panel:     #FFFFFF;
  --border:    #E6DDD0;
  --border-dk: #D0C4B0;
  --text:      #1C1712;
  --text2:     #584A38;
  --text3:     #9B8872;
  --text4:     #BFB09C;
  --green:     #1D6A2B;
  --green-lt:  #E3F5E8;
  --red:       #C0392B;
  --red-lt:    #FDECEA;
  --blue:      #1A56A0;
  --blue-lt:   #E8F0FB;
  --orange:    #C05A0A;
  --orange-lt: #FEF0E6;
  --sb:        240px;
  --topbar:    56px;
  --radius:    10px;
  --shadow:    0 1px 4px rgba(0,0,0,.06), 0 4px 16px rgba(0,0,0,.06);
  --shadow-lg: 0 8px 40px rgba(0,0,0,.14);
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
html{font-size:14px;scroll-behavior:smooth;}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--linen);color:var(--text);min-height:100vh;display:flex;overflow-x:hidden;}

/* â”€â”€â”€ SCROLLBAR â”€â”€â”€ */
::-webkit-scrollbar{width:5px;height:5px;}
::-webkit-scrollbar-track{background:var(--linen);}
::-webkit-scrollbar-thumb{background:var(--parch);border-radius:3px;}
::-webkit-scrollbar-thumb:hover{background:var(--amber);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sb{
  width:var(--sb);min-height:100vh;position:fixed;top:0;left:0;bottom:0;z-index:300;
  background:var(--forest-dk);display:flex;flex-direction:column;
  transition:transform .28s cubic-bezier(.23,1,.32,1);
  box-shadow:4px 0 24px rgba(0,0,0,.18);
}
.sb-brand{
  padding:1.2rem 1.25rem 1rem;border-bottom:1px solid rgba(255,255,255,.07);
  display:flex;align-items:center;gap:.75rem;
}
.sb-logo{
  width:40px;height:40px;border-radius:10px;flex-shrink:0;
  background:linear-gradient(135deg,var(--amber),var(--gold));
  display:flex;align-items:center;justify-content:center;font-size:1.25rem;
  box-shadow:0 4px 12px rgba(200,147,42,.4);
}
.sb-brand-text strong{display:block;font-size:.88rem;font-weight:800;color:#fff;letter-spacing:.01em;}
.sb-brand-text small{display:block;font-size:.62rem;color:rgba(255,255,255,.35);letter-spacing:.1em;text-transform:uppercase;margin-top:.1rem;}

.sb-section{padding:.25rem 0;}
.sb-group-label{
  font-size:.58rem;font-weight:700;letter-spacing:.18em;text-transform:uppercase;
  color:rgba(255,255,255,.22);padding:.7rem 1.25rem .3rem;
}
.sb-item{
  display:flex;align-items:center;gap:.65rem;padding:.58rem 1.25rem;
  font-size:.8rem;font-weight:500;color:rgba(255,255,255,.55);
  border:none;background:none;width:100%;text-align:left;cursor:pointer;
  border-left:3px solid transparent;transition:all .17s;position:relative;
}
.sb-item:hover{color:rgba(255,255,255,.9);background:rgba(255,255,255,.05);}
.sb-item.active{color:#fff;background:rgba(219,168,74,.13);border-left-color:var(--gold);font-weight:600;}
.sb-item .ico{width:18px;text-align:center;font-size:.95rem;flex-shrink:0;}
.sb-item .lbl{flex:1;}
.sb-item .badge{
  font-size:.58rem;font-weight:800;background:var(--red);color:#fff;
  padding:.12rem .45rem;border-radius:2rem;min-width:18px;text-align:center;
}
.sb-item .badge.amber{background:var(--amber);}

.sb-divider{height:1px;background:rgba(255,255,255,.07);margin:.5rem 1.25rem;}

.sb-footer{
  margin-top:auto;border-top:1px solid rgba(255,255,255,.07);padding:1rem 1.25rem;
}
.sb-user{display:flex;align-items:center;gap:.65rem;}
.sb-avatar{
  width:34px;height:34px;border-radius:50%;flex-shrink:0;
  background:linear-gradient(135deg,var(--amber),var(--gold));
  display:flex;align-items:center;justify-content:center;
  font-size:.85rem;font-weight:800;color:var(--forest-dk);
}
.sb-user-info .name{font-size:.8rem;font-weight:700;color:#fff;}
.sb-user-info .role{font-size:.62rem;color:rgba(255,255,255,.35);margin-top:.05rem;}
.sb-logout{
  margin-left:auto;background:none;border:none;cursor:pointer;
  color:rgba(255,255,255,.3);font-size:.9rem;transition:color .2s;padding:.2rem;
}
.sb-logout:hover{color:var(--red-lt);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN AREA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.main{margin-left:var(--sb);flex:1;display:flex;flex-direction:column;min-height:100vh;}

/* â”€â”€â”€ TOPBAR â”€â”€â”€ */
.topbar{
  height:var(--topbar);background:var(--panel);border-bottom:1px solid var(--border);
  display:flex;align-items:center;padding:0 1.75rem;gap:1rem;
  position:sticky;top:0;z-index:200;box-shadow:0 1px 8px rgba(0,0,0,.05);
}
.topbar-breadcrumb{display:flex;align-items:center;gap:.5rem;flex:1;}
.topbar-breadcrumb .page-name{
  font-size:.92rem;font-weight:700;color:var(--text);
}
.topbar-breadcrumb .sep{color:var(--text4);font-size:.8rem;}
.topbar-breadcrumb .sub-name{font-size:.8rem;color:var(--text3);}
.topbar-actions{display:flex;align-items:center;gap:.6rem;}
.top-chip{
  display:flex;align-items:center;gap:.4rem;
  background:var(--linen);border:1px solid var(--border);
  padding:.35rem .8rem;border-radius:.45rem;font-size:.72rem;color:var(--text2);
  white-space:nowrap;
}
.top-icon-btn{
  width:34px;height:34px;border-radius:.45rem;background:var(--linen);
  border:1px solid var(--border);display:flex;align-items:center;justify-content:center;
  cursor:pointer;font-size:.95rem;transition:all .2s;position:relative;
}
.top-icon-btn:hover{background:var(--parch);border-color:var(--amber);}
.notif-dot{
  position:absolute;top:5px;right:5px;width:7px;height:7px;
  border-radius:50%;background:var(--red);border:2px solid var(--panel);
}
.btn-view-site{
  background:var(--forest);color:#fff;border:none;padding:.38rem 1rem;border-radius:.45rem;
  font-family:'Plus Jakarta Sans',sans-serif;font-size:.73rem;font-weight:700;
  cursor:pointer;transition:all .2s;white-space:nowrap;display:flex;align-items:center;gap:.35rem;
}
.btn-view-site:hover{background:var(--sage);}

/* â”€â”€â”€ CONTENT AREA â”€â”€â”€ */
.content{padding:1.5rem;flex:1;min-width:0;}
.page{display:none;animation:fadeIn .2s ease;}
.page.active{display:block;}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px);}to{opacity:1;transform:translateY(0);}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SHARED COMPONENTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.panel{
  background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);
  box-shadow:var(--shadow);
}
.panel-hd{
  display:flex;align-items:center;justify-content:space-between;
  padding:1.1rem 1.4rem;border-bottom:1px solid var(--border);
}
.panel-hd-left .ph-title{font-size:.9rem;font-weight:700;color:var(--text);}
.panel-hd-left .ph-sub{font-size:.7rem;color:var(--text3);margin-top:.12rem;}
.panel-hd-actions{display:flex;align-items:center;gap:.5rem;}
.panel-body{padding:1.25rem 1.4rem;}

.row{display:grid;gap:1.1rem;margin-bottom:1.1rem;}
.row.cols-4{grid-template-columns:repeat(4,1fr);}
.row.cols-3{grid-template-columns:repeat(3,1fr);}
.row.cols-2{grid-template-columns:repeat(2,1fr);}
.row.cols-2-1{grid-template-columns:1.6fr 1fr;}
.row.cols-1-2{grid-template-columns:1fr 1.6fr;}
.row.cols-3-1{grid-template-columns:2fr 1fr;}

/* â”€â”€â”€ STAT CARDS â”€â”€â”€ */
.stat-card{
  background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);
  padding:1.15rem 1.3rem;box-shadow:var(--shadow);position:relative;overflow:hidden;
  transition:box-shadow .2s,transform .2s;cursor:default;
}
.stat-card:hover{box-shadow:var(--shadow-lg);transform:translateY(-1px);}
.stat-card::after{
  content:'';position:absolute;top:0;left:0;right:0;height:3px;border-radius:10px 10px 0 0;
}
.sc-green::after{background:linear-gradient(90deg,var(--green),var(--sage-lt));}
.sc-amber::after{background:linear-gradient(90deg,var(--amber),var(--gold));}
.sc-blue::after{background:linear-gradient(90deg,var(--blue),#4A8FD4);}
.sc-red::after{background:linear-gradient(90deg,var(--red),#E07070);}
.sc-purple::after{background:linear-gradient(90deg,#7C3AED,#A855F7);}
.sc-teal::after{background:linear-gradient(90deg,#0D9488,#34D399);}

.sc-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:.7rem;}
.sc-icon{
  width:40px;height:40px;border-radius:.6rem;
  display:flex;align-items:center;justify-content:center;font-size:1.1rem;
}
.sci-green{background:var(--green-lt);}
.sci-amber{background:#FEF3E2;}
.sci-blue{background:var(--blue-lt);}
.sci-red{background:var(--red-lt);}
.sci-purple{background:#F5F3FF;}
.sci-teal{background:#F0FDFA;}
.sc-trend{
  font-size:.65rem;font-weight:700;padding:.18rem .5rem;border-radius:2rem;
  display:flex;align-items:center;gap:.2rem;
}
.trend-up{background:var(--green-lt);color:var(--green);}
.trend-dn{background:var(--red-lt);color:var(--red);}
.trend-neu{background:var(--linen);color:var(--text3);}
.sc-val{font-size:1.75rem;font-weight:800;color:var(--text);line-height:1;margin-bottom:.25rem;}
.sc-label{font-size:.7rem;font-weight:500;color:var(--text3);}
.sc-sub{font-size:.65rem;color:var(--text4);margin-top:.15rem;}

/* â”€â”€â”€ BUTTONS â”€â”€â”€ */
.btn{
  display:inline-flex;align-items:center;gap:.4rem;
  border:none;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;font-weight:600;
  transition:all .2s;border-radius:.45rem;white-space:nowrap;
}
.btn-sm{font-size:.72rem;padding:.35rem .8rem;}
.btn-md{font-size:.78rem;padding:.5rem 1.1rem;}
.btn-lg{font-size:.82rem;padding:.65rem 1.4rem;}
.btn-primary{background:linear-gradient(135deg,var(--forest),var(--sage));color:#fff;box-shadow:0 2px 12px rgba(43,74,26,.3);}
.btn-primary:hover{box-shadow:0 4px 20px rgba(43,74,26,.45);transform:translateY(-1px);}
.btn-amber{background:linear-gradient(135deg,var(--amber),var(--gold));color:var(--forest-dk);box-shadow:0 2px 12px rgba(200,147,42,.3);}
.btn-amber:hover{box-shadow:0 4px 20px rgba(200,147,42,.45);transform:translateY(-1px);}
.btn-ghost{background:var(--linen);color:var(--text2);border:1px solid var(--border);}
.btn-ghost:hover{border-color:var(--amber);background:var(--parch);}
.btn-danger{background:var(--red-lt);color:var(--red);border:1px solid #FCA5A5;}
.btn-danger:hover{background:var(--red);color:#fff;}
.btn-outline{background:transparent;color:var(--amber);border:1.5px solid var(--amber);}
.btn-outline:hover{background:var(--amber);color:#fff;}
.btn-icon-only{
  width:32px;height:32px;padding:0;display:flex;align-items:center;justify-content:center;
  font-size:.85rem;border-radius:.4rem;border:1px solid var(--border);
  background:var(--linen);color:var(--text2);cursor:pointer;transition:all .2s;
}
.btn-icon-only:hover{border-color:var(--amber);background:var(--parch);}

/* â”€â”€â”€ FORM ELEMENTS â”€â”€â”€ */
.fg{margin-bottom:.9rem;}
.fg label,.fg-label{
  display:block;font-size:.68rem;font-weight:700;letter-spacing:.07em;
  text-transform:uppercase;color:var(--text2);margin-bottom:.38rem;
}
.fg input,.fg select,.fg textarea,.fg-ctrl{
  width:100%;border:1.5px solid var(--border);border-radius:.45rem;
  padding:.62rem .9rem;font-family:'Plus Jakarta Sans',sans-serif;
  font-size:.82rem;color:var(--text);background:var(--snow);outline:none;transition:border-color .2s;
}
.fg input:focus,.fg select:focus,.fg textarea:focus{border-color:var(--amber);background:#fff;}
.fg input[readonly]{background:var(--linen);color:var(--text2);}
.fg textarea{resize:vertical;min-height:76px;}
.fg select option{background:#fff;}
.fg .fg-hint{font-size:.65rem;color:var(--text4);margin-top:.28rem;}
.fg-row{display:grid;grid-template-columns:1fr 1fr;gap:.85rem;}
.fg-row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:.85rem;}
.fg input[type=checkbox]{width:auto;}
.toggle-wrap{display:flex;align-items:center;gap:.65rem;padding:.5rem 0;}
.toggle{width:40px;height:22px;border-radius:11px;background:var(--border);position:relative;cursor:pointer;transition:background .2s;flex-shrink:0;border:none;}
.toggle::after{content:'';position:absolute;top:3px;left:3px;width:16px;height:16px;border-radius:50%;background:#fff;transition:transform .2s;box-shadow:0 1px 4px rgba(0,0,0,.2);}
.toggle.on{background:var(--sage);}
.toggle.on::after{transform:translateX(18px);}
.toggle-label{font-size:.8rem;font-weight:500;color:var(--text2);}

/* â”€â”€â”€ TABLES â”€â”€â”€ */
.tbl-wrap{overflow-x:auto;border-radius:0 0 var(--radius) var(--radius);}
table.tbl{width:100%;border-collapse:collapse;min-width:700px;}
.tbl th{
  font-size:.62rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;
  color:var(--text3);padding:.62rem 1rem;text-align:left;
  background:var(--linen);border-bottom:2px solid var(--border);white-space:nowrap;
}
.tbl th:first-child{border-radius:0;}
.tbl td{
  font-size:.8rem;padding:.68rem 1rem;border-bottom:1px solid var(--linen);
  vertical-align:middle;color:var(--text);
}
.tbl tr:last-child td{border-bottom:none;}
.tbl tbody tr:hover td{background:#FDFAF5;}

/* â”€â”€â”€ STATUS PILLS â”€â”€â”€ */
.pill{font-size:.62rem;font-weight:700;letter-spacing:.06em;text-transform:uppercase;padding:.2rem .65rem;border-radius:2rem;display:inline-block;white-space:nowrap;}
.p-confirmed{background:#DCFCE7;color:#15803D;}
.p-pending{background:#FEF9C3;color:#92400E;}
.p-checkedin{background:#DBEAFE;color:#1E40AF;}
.p-checkedout{background:#F3F4F6;color:#4B5563;}
.p-cancelled{background:#FEE2E2;color:#B91C1C;}
.p-available{background:#DCFCE7;color:#15803D;}
.p-occupied{background:#FEE2E2;color:#B91C1C;}

/* â”€â”€â”€ SECTION LABEL â”€â”€â”€ */
.section-label{
  font-size:.62rem;font-weight:700;letter-spacing:.14em;text-transform:uppercase;
  color:var(--text3);padding:.8rem 0 .5rem;border-bottom:1px solid var(--border);margin-bottom:.9rem;
}

/* â”€â”€â”€ CHARTS â”€â”€â”€ */
.chart-bars{
  display:flex;align-items:flex-end;gap:6px;height:160px;
}
.bar-col{flex:1;display:flex;flex-direction:column;align-items:center;gap:.3rem;}
.bar-track{
  width:100%;flex:1;background:var(--linen);border-radius:.3rem .3rem 0 0;
  display:flex;align-items:flex-end;position:relative;cursor:pointer;
}
.bar-fill{
  width:100%;min-height:3px;border-radius:.3rem .3rem 0 0;
  background:linear-gradient(to top,var(--forest),var(--sage));
  transition:height .7s cubic-bezier(.23,1,.32,1);
  position:relative;
}
.bar-fill.peak{background:linear-gradient(to top,var(--amber),var(--gold));}
.bar-fill:hover::after{
  content:attr(data-tip);
  position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);
  background:var(--text);color:#fff;font-size:.62rem;font-weight:600;
  padding:.18rem .45rem;border-radius:.25rem;white-space:nowrap;pointer-events:none;z-index:10;
}
.bar-lbl{font-size:.6rem;color:var(--text3);font-weight:600;text-align:center;}

/* Donut ring */
.donut-container{display:flex;align-items:center;gap:1.5rem;}
.donut-legend{flex:1;}
.dl-row{display:flex;align-items:center;gap:.5rem;margin-bottom:.55rem;}
.dl-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;}
.dl-name{font-size:.75rem;color:var(--text2);flex:1;}
.dl-val{font-size:.75rem;font-weight:700;color:var(--text);}

/* â”€â”€â”€ CALENDAR â”€â”€â”€ */
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;}
.cal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;}
.cal-nav{width:28px;height:28px;border-radius:50%;background:var(--linen);border:1px solid var(--border);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.8rem;transition:all .2s;}
.cal-nav:hover{background:var(--amber);color:#fff;border-color:var(--amber);}
.cal-month-label{font-size:.88rem;font-weight:700;color:var(--text);}
.cal-dname{text-align:center;font-size:.58rem;font-weight:700;letter-spacing:.08em;text-transform:uppercase;color:var(--text4);padding:.35rem .1rem;}
.cal-day{
  text-align:center;padding:.42rem .1rem;border-radius:.3rem;font-size:.75rem;
  cursor:pointer;transition:all .15s;color:var(--text);position:relative;
}
.cal-day:hover:not(.cal-empty):not(.cal-full){background:var(--linen);}
.cal-today{background:var(--amber)!important;color:#fff!important;font-weight:700;}
.cal-full{background:#FEE2E2!important;color:#B91C1C!important;cursor:default;}
.cal-partial{background:#FEF9C3!important;color:#92400E!important;}
.cal-empty{cursor:default;}
.cal-past{color:var(--text4);}

/* â”€â”€â”€ UPCOMING ITEM â”€â”€â”€ */
.upc-item{display:flex;gap:.8rem;padding:.75rem 0;border-bottom:1px solid var(--linen);}
.upc-item:last-child{border-bottom:none;}
.upc-date-box{width:42px;flex-shrink:0;text-align:center;background:var(--linen);border-radius:.4rem;padding:.4rem .2rem;}
.upc-dd{font-size:1.1rem;font-weight:800;color:var(--forest);line-height:1;}
.upc-mo{font-size:.55rem;font-weight:700;letter-spacing:.08em;text-transform:uppercase;color:var(--text3);}
.upc-info{flex:1;min-width:0;}
.upc-name{font-size:.8rem;font-weight:700;color:var(--text);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.upc-meta{font-size:.7rem;color:var(--text3);margin-top:.1rem;}

/* â”€â”€â”€ ROOM CARD â”€â”€â”€ */
.room-card-live{
  border-radius:.6rem;padding:1rem 1.1rem;border:1.5px solid var(--border);transition:all .2s;
}
.room-card-live.occ{border-color:#FCA5A5;background:#FFF8F8;}
.room-card-live.avail{border-color:#86EFAC;background:#F0FDF4;}
.rcl-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:.6rem;}
.rcl-name{font-size:.85rem;font-weight:700;color:var(--text);}
.rcl-body .rcl-guest{font-size:.78rem;font-weight:600;color:var(--text);margin-bottom:.15rem;}
.rcl-body .rcl-info{font-size:.7rem;color:var(--text3);}
.rcl-progress{height:5px;background:var(--border);border-radius:3px;margin-top:.75rem;}
.rcl-progress-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--amber),var(--gold));}

/* â”€â”€â”€ NOTIFICATIONS â”€â”€â”€ */
.notif-dropdown{
  position:absolute;top:calc(100% + 8px);right:0;width:320px;
  background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);
  box-shadow:var(--shadow-lg);z-index:500;display:none;
}
.notif-dropdown.open{display:block;}
.notif-hd{display:flex;align-items:center;justify-content:space-between;padding:.9rem 1.1rem;border-bottom:1px solid var(--border);}
.notif-hd span{font-size:.82rem;font-weight:700;}
.notif-item{padding:.8rem 1.1rem;border-bottom:1px solid var(--linen);cursor:pointer;transition:background .15s;}
.notif-item:hover{background:var(--linen);}
.notif-item:last-child{border-bottom:none;}
.notif-item-title{font-size:.78rem;font-weight:600;color:var(--text);}
.notif-item-time{font-size:.67rem;color:var(--text3);margin-top:.1rem;}
.notif-item.unread{border-left:3px solid var(--amber);}

/* â”€â”€â”€ TOAST â”€â”€â”€ */
.toast{
  position:fixed;bottom:1.5rem;right:1.5rem;z-index:9999;
  display:flex;align-items:center;gap:.7rem;
  background:var(--forest-dk);color:#fff;
  padding:.85rem 1.3rem;border-radius:.6rem;
  font-size:.8rem;font-weight:500;max-width:320px;
  box-shadow:var(--shadow-lg);
  transform:translateY(80px);opacity:0;
  transition:all .35s cubic-bezier(.23,1,.32,1);
  border-left:4px solid var(--gold);
}
.toast.show{transform:translateY(0);opacity:1;}
.toast.t-ok{border-left-color:var(--sage-lt);}
.toast.t-err{border-left-color:var(--red);}
.toast.t-warn{border-left-color:var(--gold);}

/* â”€â”€â”€ MODAL â”€â”€â”€ */
.modal-bg{
  display:none;position:fixed;inset:0;z-index:600;
  background:rgba(20,14,5,.65);backdrop-filter:blur(5px);
  align-items:center;justify-content:center;padding:1rem;
}
.modal-bg.open{display:flex;}
.modal{
  background:var(--panel);border-radius:var(--radius);
  width:100%;max-width:540px;max-height:92vh;overflow-y:auto;
  box-shadow:0 32px 100px rgba(0,0,0,.35);
  animation:mpop .3s cubic-bezier(.23,1,.32,1);
}
.modal-lg{max-width:720px;}
@keyframes mpop{from{opacity:0;transform:scale(.93)translateY(16px);}to{opacity:1;transform:scale(1)translateY(0);}}
.modal-hd{
  display:flex;align-items:center;justify-content:space-between;
  padding:1.1rem 1.4rem;border-bottom:1px solid var(--border);
  position:sticky;top:0;background:var(--panel);z-index:1;
}
.modal-hd h3{font-size:.95rem;font-weight:800;color:var(--text);}
.modal-body{padding:1.4rem;}
.modal-ft{padding:1rem 1.4rem;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:.6rem;}
.modal-close-btn{
  width:30px;height:30px;border-radius:50%;
  background:var(--linen);border:none;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  font-size:.85rem;color:var(--text3);transition:all .2s;
}
.modal-close-btn:hover{background:var(--red-lt);color:var(--red);}

/* â”€â”€â”€ EMPTY STATE â”€â”€â”€ */
.empty{text-align:center;padding:3rem 1.5rem;color:var(--text3);}
.empty .empty-ico{font-size:2.5rem;opacity:.3;margin-bottom:.75rem;}
.empty p{font-size:.82rem;}

/* â”€â”€â”€ INSIGHT CARD â”€â”€â”€ */
.insight-card{
  border-radius:.6rem;padding:1rem 1.1rem;position:relative;overflow:hidden;
}
.insight-card.green{background:var(--green-lt);border:1px solid #86EFAC;}
.insight-card.amber{background:#FFFBEB;border:1px solid #FCD34D;}
.insight-card.red{background:var(--red-lt);border:1px solid #FCA5A5;}
.insight-card.blue{background:var(--blue-lt);border:1px solid #93C5FD;}
.insight-tag{font-size:.6rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;margin-bottom:.4rem;}
.insight-tag.green{color:var(--green);}
.insight-tag.amber{color:#92400E;}
.insight-tag.red{color:var(--red);}
.insight-tag.blue{color:var(--blue);}
.insight-val{font-size:1.4rem;font-weight:800;color:var(--text);line-height:1;}
.insight-desc{font-size:.72rem;color:var(--text2);margin-top:.3rem;line-height:1.5;}

/* â”€â”€â”€ SETTINGS TABS â”€â”€â”€ */
.stabs{display:flex;gap:.2rem;background:var(--linen);border-radius:.55rem;padding:.3rem;}
.stab{
  padding:.45rem 1rem;border-radius:.4rem;font-size:.75rem;font-weight:600;
  color:var(--text3);cursor:pointer;border:none;background:none;transition:all .2s;
}
.stab.active{background:var(--panel);color:var(--text);box-shadow:var(--shadow);}
.stab-pane{display:none;}
.stab-pane.active{display:block;}

/* â”€â”€â”€ LOG TABLE â”€â”€â”€ */
.log-item{
  display:flex;align-items:flex-start;gap:.75rem;
  padding:.65rem .9rem;border-bottom:1px solid var(--linen);font-size:.77rem;
}
.log-item:last-child{border-bottom:none;}
.log-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;margin-top:.28rem;}
.log-ld-green{background:var(--green);}
.log-ld-amber{background:var(--amber);}
.log-ld-red{background:var(--red);}
.log-ld-blue{background:var(--blue);}
.log-msg{flex:1;color:var(--text2);line-height:1.4;}
.log-time{font-size:.65rem;color:var(--text4);white-space:nowrap;margin-top:.1rem;}

/* â”€â”€â”€ REPORTS â”€â”€â”€ */
.rpt-header{
  background:linear-gradient(135deg,var(--forest-dk),var(--forest));
  border-radius:var(--radius) var(--radius) 0 0;padding:1.4rem 1.75rem;
  display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:1rem;
}
.rpt-header h2{font-family:'Playfair Display',serif;font-size:1.3rem;font-weight:700;color:#fff;font-style:italic;}
.rpt-header p{font-size:.72rem;color:rgba(255,255,255,.5);margin-top:.2rem;}
.rpt-controls{display:flex;gap:.5rem;flex-wrap:wrap;}
.rpt-ctrl{
  background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.18);
  color:#fff;padding:.38rem .8rem;border-radius:.35rem;
  font-family:'Plus Jakarta Sans',sans-serif;font-size:.74rem;outline:none;cursor:pointer;
}
.rpt-ctrl option{background:#1A2E10;color:#fff;}

.month-bar-mini{height:6px;background:var(--border);border-radius:3px;margin-top:.3rem;}
.mbm-fill{height:100%;border-radius:3px;}
.mbm-green{background:linear-gradient(90deg,var(--sage),var(--sage-lt));}
.mbm-amber{background:linear-gradient(90deg,var(--amber),var(--gold));}

/* â”€â”€â”€ GUEST HISTORY â”€â”€â”€ */
.guest-card{
  display:flex;align-items:center;gap:.85rem;padding:.75rem .9rem;
  border-radius:.5rem;border:1px solid var(--border);margin-bottom:.6rem;
  background:var(--snow);cursor:pointer;transition:all .2s;
}
.guest-card:hover{border-color:var(--amber);box-shadow:0 2px 12px rgba(0,0,0,.07);}
.guest-ava{
  width:36px;height:36px;border-radius:50%;flex-shrink:0;
  background:linear-gradient(135deg,var(--forest),var(--sage));
  display:flex;align-items:center;justify-content:center;
  font-size:.85rem;font-weight:800;color:#fff;
}
.guest-nm{font-size:.8rem;font-weight:700;color:var(--text);}
.guest-det{font-size:.7rem;color:var(--text3);margin-top:.08rem;}
.guest-stats{margin-left:auto;text-align:right;}
.guest-stat-val{font-size:.88rem;font-weight:800;color:var(--amber);}
.guest-stat-lbl{font-size:.62rem;color:var(--text4);}

/* â”€â”€â”€ RESPONSIVE â”€â”€â”€ */
@media(max-width:1100px){.row.cols-4{grid-template-columns:repeat(2,1fr);}.row.cols-3{grid-template-columns:repeat(2,1fr);}.row.cols-2-1,.row.cols-1-2,.row.cols-3-1{grid-template-columns:1fr;}}
@media(max-width:860px){.row.cols-2{grid-template-columns:1fr;}.fg-row,.fg-row-3{grid-template-columns:1fr;}}
@media(max-width:768px){:root{--sb:0px;}.sb{transform:translateX(-240px);}.sb.open{transform:translateX(0);--sb:240px;}.main{margin-left:0;}}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<aside class="sb" id="sidebar">
  <div class="sb-brand">
    <div class="sb-logo">ğŸŒ´</div>
    <div class="sb-brand-text">
      <strong>Espacio Norte</strong>
      <small>Admin Panel</small>
    </div>
  </div>

  <nav style="flex:1;overflow-y:auto;padding:.5rem 0;">
    <div class="sb-group-label">Overview</div>
    <button class="sb-item active" data-page="dashboard">
      <span class="ico">ğŸ“Š</span><span class="lbl">Dashboard</span>
    </button>
    <button class="sb-item" data-page="analytics">
      <span class="ico">ğŸ“ˆ</span><span class="lbl">Analytics & Reports</span>
    </button>

    <div class="sb-group-label">Reservations</div>
    <button class="sb-item" data-page="bookings">
      <span class="ico">ğŸ“…</span><span class="lbl">All Bookings</span>
      <span class="badge" id="sb-pending-badge" style="display:none">0</span>
    </button>
    <button class="sb-item" data-page="new-booking">
      <span class="ico">â•</span><span class="lbl">New Booking</span>
    </button>
    <button class="sb-item" data-page="calendar">
      <span class="ico">ğŸ—“ï¸</span><span class="lbl">Booking Calendar</span>
    </button>
    <button class="sb-item" data-page="guests">
      <span class="ico">ğŸ‘¥</span><span class="lbl">Guest Directory</span>
    </button>

    <div class="sb-group-label">Property</div>
    <button class="sb-item" data-page="rooms">
      <span class="ico">ğŸ </span><span class="lbl">Room Management</span>
    </button>
    <button class="sb-item" data-page="pricing">
      <span class="ico">ğŸ’°</span><span class="lbl">Pricing & Rules</span>
    </button>

    <div class="sb-group-label">System</div>
    <button class="sb-item" data-page="activity">
      <span class="ico">ğŸ•</span><span class="lbl">Activity Log</span>
    </button>
    <button class="sb-item" data-page="settings">
      <span class="ico">âš™ï¸</span><span class="lbl">Settings</span>
    </button>
  </nav>

  <div class="sb-footer">
    <div class="sb-user">
      <div class="sb-avatar">A</div>
      <div class="sb-user-info">
        <div class="name" id="admin-display-name">Admin</div>
        <div class="role">Property Manager</div>
      </div>
      <button class="sb-logout" onclick="logout('')" title="Log out">â‹</button>
    </div>
  </div>
</aside>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="main">

  <!-- TOPBAR -->
  <header class="topbar">
    <div class="topbar-breadcrumb">
      <span class="page-name" id="topbar-title">Dashboard</span>
    </div>
    <div class="topbar-actions">
      <div class="top-chip">ğŸ“… <span id="today-label"></span></div>
      <div style="position:relative;">
        <div class="top-icon-btn" onclick="toggleNotifs()" id="notif-btn">
          ğŸ””<div class="notif-dot" id="notif-dot"></div>
        </div>
        <div class="notif-dropdown" id="notif-panel">
          <div class="notif-hd"><span>Notifications</span><button class="btn btn-sm btn-ghost" onclick="clearNotifs()">Clear all</button></div>
          <div id="notif-list"></div>
        </div>
      </div>
      <button class="btn-view-site" onclick="window.open('index.html','_blank')">ğŸŒ View Website</button>
    </div>
  </header>

  <!-- â•â•â•â•â•â•â•â• CONTENT PAGES â•â•â•â•â•â•â•â• -->
  <div class="content">

    <!-- â–‘â–‘â–‘â–‘â–‘â–‘â–‘ PAGE: DASHBOARD â–‘â–‘â–‘â–‘â–‘â–‘â–‘ -->
    <div class="page active" id="page-dashboard">
      <div class="row cols-4">
        <div class="stat-card sc-green">
          <div class="sc-top"><div class="sc-icon sci-green">ğŸ’°</div><span class="sc-trend trend-up" id="rev-trend">+0%</span></div>
          <div class="sc-val" id="d-rev">â‚±0</div>
          <div class="sc-label">Revenue This Month</div>
          <div class="sc-sub" id="d-rev-sub">vs last month</div>
        </div>
        <div class="stat-card sc-amber">
          <div class="sc-top"><div class="sc-icon sci-amber">ğŸ“…</div><span class="sc-trend" id="bk-trend">â€”</span></div>
          <div class="sc-val" id="d-bk">0</div>
          <div class="sc-label">Total Bookings</div>
          <div class="sc-sub" id="d-bk-sub">all time</div>
        </div>
        <div class="stat-card sc-blue">
          <div class="sc-top"><div class="sc-icon sci-blue">ğŸ </div><span class="sc-trend trend-neu" id="occ-trend">Live</span></div>
          <div class="sc-val" id="d-occ">0%</div>
          <div class="sc-label">Current Occupancy</div>
          <div class="sc-sub" id="d-occ-sub">rooms in use now</div>
        </div>
        <div class="stat-card sc-red">
          <div class="sc-top"><div class="sc-icon sci-red">â³</div><span class="sc-trend trend-neu" style="background:#FEF9C3;color:#92400E">Action</span></div>
          <div class="sc-val" id="d-pend">0</div>
          <div class="sc-label">Pending Bookings</div>
          <div class="sc-sub">need confirmation</div>
        </div>
      </div>

      <div class="row cols-2-1">
        <!-- Monthly Chart -->
        <div class="panel">
          <div class="panel-hd">
            <div class="panel-hd-left">
              <div class="ph-title">Monthly Bookings Overview</div>
              <div class="ph-sub">Last 12 months â€” <span style="color:var(--amber);font-weight:700;">â˜…</span> peak month highlighted</div>
            </div>
            <div class="panel-hd-actions">
              <select class="btn btn-sm btn-ghost" id="chart-year" onchange="renderBarChart()" style="cursor:pointer;padding:.3rem .6rem;font-size:.72rem;">
                <option>2026</option><option>2025</option>
              </select>
            </div>
          </div>
          <div class="panel-body">
            <div style="display:flex;align-items:flex-end;gap:.5rem;">
              <div style="display:flex;flex-direction:column;justify-content:space-between;height:160px;font-size:.58rem;color:var(--text4);text-align:right;padding-bottom:1.4rem;margin-right:.3rem;flex-shrink:0;" id="y-axis"></div>
              <div class="chart-bars" id="bar-chart" style="flex:1;"></div>
            </div>
          </div>
        </div>
        <!-- Donut + Room Status -->
        <div style="display:flex;flex-direction:column;gap:1.1rem;">
          <div class="panel">
            <div class="panel-hd"><div class="panel-hd-left"><div class="ph-title">Booking Split</div><div class="ph-sub">By suite this month</div></div></div>
            <div class="panel-body">
              <div class="donut-container">
                <svg width="90" height="90" viewBox="0 0 90 90" class="donut-svg" id="donut-svg">
                  <circle cx="45" cy="45" r="35" fill="none" stroke="var(--linen)" stroke-width="12"/>
                  <circle id="donut-r1" cx="45" cy="45" r="35" fill="none" stroke="var(--forest)" stroke-width="12" stroke-dasharray="220 0" stroke-dashoffset="55" transform="rotate(-90 45 45)" style="transition:all .7s;"/>
                  <circle id="donut-r2" cx="45" cy="45" r="35" fill="none" stroke="var(--amber)" stroke-width="12" stroke-dasharray="0 220" stroke-dashoffset="55" transform="rotate(-90 45 45)" style="transition:all .7s;"/>
                </svg>
                <div class="donut-legend">
                  <div class="dl-row"><div class="dl-dot" style="background:var(--forest)"></div><div class="dl-name">Suite 1 Â· Sunset</div><div class="dl-val" id="donut-v1">0</div></div>
                  <div class="dl-row"><div class="dl-dot" style="background:var(--amber)"></div><div class="dl-name">Suite 2 Â· Oceana</div><div class="dl-val" id="donut-v2">0</div></div>
                  <div class="dl-row"><div class="dl-dot" style="background:var(--red)"></div><div class="dl-name">Cancelled</div><div class="dl-val" id="donut-vc">0</div></div>
                </div>
              </div>
            </div>
          </div>
          <div class="panel">
            <div class="panel-hd"><div class="panel-hd-left"><div class="ph-title">Live Room Status</div></div></div>
            <div class="panel-body" id="live-rooms" style="display:grid;gap:.7rem;"></div>
          </div>
        </div>
      </div>

      <div class="row cols-2">
        <!-- Recent Bookings -->
        <div class="panel">
          <div class="panel-hd">
            <div class="panel-hd-left"><div class="ph-title">Recent Bookings</div></div>
            <div class="panel-hd-actions">
              <button class="btn btn-sm btn-ghost" onclick="goPage('bookings')">View All â†’</button>
            </div>
          </div>
          <div class="tbl-wrap">
            <table class="tbl">
              <thead><tr><th>Guest</th><th>Suite</th><th>Check-in</th><th>Status</th><th></th></tr></thead>
              <tbody id="dash-recent"></tbody>
            </table>
          </div>
        </div>
        <!-- Upcoming + Quick Actions -->
        <div style="display:flex;flex-direction:column;gap:1.1rem;">
          <div class="panel">
            <div class="panel-hd"><div class="panel-hd-left"><div class="ph-title">Upcoming Check-ins</div><div class="ph-sub">Next 5 arrivals</div></div></div>
            <div class="panel-body" id="dash-upcoming"></div>
          </div>
          <div class="panel">
            <div class="panel-hd"><div class="panel-hd-left"><div class="ph-title">Quick Actions</div></div></div>
            <div class="panel-body" style="display:grid;grid-template-columns:1fr 1fr;gap:.6rem;">
              <button class="btn btn-primary btn-md" onclick="goPage('new-booking')" style="justify-content:center;">â• New Booking</button>
              <button class="btn btn-amber btn-md" onclick="exportCSV()" style="justify-content:center;">ğŸ“¥ Export CSV</button>
              <button class="btn btn-ghost btn-md" onclick="goPage('calendar')" style="justify-content:center;">ğŸ—“ï¸ Calendar</button>
              <button class="btn btn-ghost btn-md" onclick="goPage('analytics')" style="justify-content:center;">ğŸ“Š Reports</button>
              <button class="btn btn-ghost btn-md" onclick="goPage('guests')" style="justify-content:center;">ğŸ‘¥ Guests</button>
              <button class="btn btn-ghost btn-md" onclick="window.print()" style="justify-content:center;">ğŸ–¨ï¸ Print</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â–‘â–‘â–‘â–‘â–‘â–‘â–‘ PAGE: ANALYTICS â–‘â–‘â–‘â–‘â–‘â–‘â–‘ -->
    <div class="page" id="page-analytics">
      <div class="panel" style="margin-bottom:1.1rem;">
        <div class="rpt-header">
          <div><h2>Reports & Analytics</h2><p>Track performance, identify trends, and grow your business</p></div>
          <div class="rpt-controls">
            <select class="rpt-ctrl" id="rpt-year" onchange="buildReports()"><option>2026</option><option>2025</option></select>
            <button class="btn btn-amber btn-md" onclick="exportCSV()">ğŸ“¥ Export CSV</button>
            <button class="btn btn-ghost btn-md" style="color:#fff;border-color:rgba(255,255,255,.3);" onclick="window.print()">ğŸ–¨ï¸ Print</button>
          </div>
        </div>
        <div class="panel-body">
          <div class="row cols-3" id="rpt-kpis" style="margin-bottom:1.5rem;"></div>
          <div class="row cols-2" style="margin-bottom:1.5rem;">
            <div>
              <div style="font-size:.8rem;font-weight:700;margin-bottom:1rem;color:var(--text);">ğŸ“… Monthly Breakdown</div>
              <div class="tbl-wrap">
                <table class="tbl" id="month-table" style="min-width:auto;">
                  <thead><tr><th>Month</th><th>Bookings</th><th>Revenue</th><th>Trend</th></tr></thead>
                  <tbody id="month-tbody"></tbody>
                </table>
              </div>
            </div>
            <div>
              <div style="font-size:.8rem;font-weight:700;margin-bottom:1rem;color:var(--text);">ğŸ’¡ Business Insights</div>
              <div id="rpt-insights" style="display:flex;flex-direction:column;gap:.75rem;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â–‘â–‘â–‘â–‘â–‘â–‘â–‘ PAGE: ALL BOOKINGS â–‘â–‘â–‘â–‘â–‘â–‘â–‘ -->
    <div class="page" id="page-bookings">
      <div class="panel">
        <div class="panel-hd">
          <div class="panel-hd-left">
            <div class="ph-title">All Reservations</div>
            <div class="ph-sub">Click a row to view details â€” use filters to find bookings</div>
          </div>
          <div class="panel-hd-actions">
            <button class="btn btn-primary btn-md" onclick="goPage('new-booking')">â• New Booking</button>
          </div>
        </div>
        <div class="panel-body" style="padding-bottom:.5rem;">
          <div style="display:flex;gap:.6rem;flex-wrap:wrap;align-items:center;">
            <div style="position:relative;flex:1;min-width:200px;">
              <input type="text" id="bk-search" placeholder="ğŸ”  Search by name, phone, reference..." oninput="filterBookings()"
                style="width:100%;border:1.5px solid var(--border);border-radius:.45rem;padding:.55rem .9rem;font-family:'Plus Jakarta Sans',sans-serif;font-size:.8rem;outline:none;background:var(--snow);">
            </div>
            <select id="bk-status" onchange="filterBookings()" style="border:1.5px solid var(--border);border-radius:.45rem;padding:.55rem .75rem;font-family:'Plus Jakarta Sans',sans-serif;font-size:.78rem;outline:none;background:var(--snow);">
              <option value="">All Status</option>
              <option value="pending">Pending</option>
              <option value="confirmed">Confirmed</option>
              <option value="checkedin">Checked In</option>
              <option value="checkedout">Checked Out</option>
              <option value="cancelled">Cancelled</option>
            </select>
            <select id="bk-room" onchange="filterBookings()" style="border:1.5px solid var(--border);border-radius:.45rem;padding:.55rem .75rem;font-family:'Plus Jakarta Sans',sans-serif;font-size:.78rem;outline:none;background:var(--snow);">
              <option value="">All Suites</option>
              <option value="1">Suite 1</option>
              <option value="2">Suite 2</option>
            </select>
            <select id="bk-month" onchange="filterBookings()" style="border:1.5px solid var(--border);border-radius:.45rem;padding:.55rem .75rem;font-family:'Plus Jakarta Sans',sans-serif;font-size:.78rem;outline:none;background:var(--snow);">
              <option value="">All Months</option>
              <option value="0">January</option><option value="1">February</option><option value="2">March</option>
              <option value="3">April</option><option value="4">May</option><option value="5">June</option>
              <option value="6">July</option><option value="7">August</option><option value="8">September</option>
              <option value="9">October</option><option value="10">November</option><option value="11">December</option>
            </select>
            <button class="btn btn-ghost btn-sm" onclick="clearFilters()">âœ• Clear</button>
          </div>
          <div style="font-size:.7rem;color:var(--text3);margin-top:.6rem;" id="bk-count"></div>
        </div>
        <div class="tbl-wrap">
          <table class="tbl">
            <thead><tr>
              <th>Ref #</th><th>Guest</th><th>Suite</th><th>Check-in</th><th>Check-out</th>
              <th>Pax</th><th>Total</th><th>Payment</th><th>Status</th><th>Actions</th>
            </tr></thead>
            <tbody id="bk-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â–‘â–‘â–‘â–‘â–‘â–‘â–‘ PAGE: NEW BOOKING â–‘â–‘â–‘â–‘â–‘â–‘â–‘ -->
    <div class="page" id="page-new-booking">
      <div style="max-width:680px;">
        <div class="panel">
          <div class="panel-hd">
            <div class="panel-hd-left">
              <div class="ph-title">Create New Booking</div>
              <div class="ph-sub">Fields marked * are required</div>
            </div>
          </div>
          <div class="panel-body">
            <div class="section-label">ğŸ‘¤ Guest Information</div>
            <div class="fg-row">
              <div class="fg"><label>First Name *</label><input type="text" id="nb-fn" placeholder="Juan"></div>
              <div class="fg"><label>Last Name *</label><input type="text" id="nb-ln" placeholder="Dela Cruz"></div>
            </div>
            <div class="fg-row">
              <div class="fg"><label>Phone Number *</label><input type="tel" id="nb-ph" placeholder="+63 9XX XXX XXXX"></div>
              <div class="fg"><label>Email (optional)</label><input type="email" id="nb-em" placeholder="guest@email.com"></div>
            </div>
            <div class="fg"><label>Facebook / Messenger</label><input type="text" id="nb-fb" placeholder="Facebook name or link"></div>

            <div class="section-label">ğŸ  Reservation Details</div>
            <div class="fg-row">
              <div class="fg"><label>Suite *</label>
                <select id="nb-rm" onchange="nbCalc()">
                  <option value="">â€” Select Suite â€”</option>
                  <option value="1">Suite 1 Â· Sunset Suite (King Bed)</option>
                  <option value="2">Suite 2 Â· Oceana Suite (Queen Bed)</option>
                </select>
              </div>
              <div class="fg"><label>Number of Guests *</label>
                <input type="number" id="nb-px" min="1" max="4" value="2">
                <div class="fg-hint">Maximum 4 guests per suite</div>
              </div>
            </div>
            <div class="fg-row">
              <div class="fg"><label>Check-in Date & Time *</label><input type="datetime-local" id="nb-ci" onchange="nbCalc()"></div>
              <div class="fg"><label>Check-out (Auto +21 hrs)</label><input type="text" id="nb-co" readonly placeholder="Calculated automatically"></div>
            </div>

            <div class="section-label">ğŸ’³ Payment & Notes</div>
            <div class="fg-row">
              <div class="fg"><label>Payment Method</label>
                <select id="nb-pay">
                  <option value="cash">Cash on Arrival</option>
                  <option value="gcash">GCash</option>
                  <option value="bank">Bank Transfer</option>
                  <option value="paid">Already Paid</option>
                </select>
              </div>
              <div class="fg"><label>Booking Status</label>
                <select id="nb-st">
                  <option value="confirmed">Confirmed</option>
                  <option value="pending">Pending (awaiting payment)</option>
                </select>
              </div>
            </div>
            <div class="fg"><label>Special Requests / Notes</label>
              <textarea id="nb-note" placeholder="e.g. Anniversary celebration, early check-in, extra towels, dietary needsâ€¦"></textarea>
            </div>

            <!-- Summary Box -->
            <div style="background:linear-gradient(135deg,var(--forest-dk),var(--forest));border-radius:.55rem;padding:1.1rem 1.25rem;margin:.5rem 0 1.25rem;">
              <div style="font-size:.62rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;color:rgba(255,255,255,.45);margin-bottom:.7rem;">BOOKING SUMMARY</div>
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:.4rem .5rem;">
                <div style="font-size:.72rem;color:rgba(255,255,255,.5);">Suite</div><div style="font-size:.72rem;font-weight:600;color:#fff;" id="nbs-rm">â€”</div>
                <div style="font-size:.72rem;color:rgba(255,255,255,.5);">Check-in</div><div style="font-size:.72rem;font-weight:600;color:#fff;" id="nbs-ci">â€”</div>
                <div style="font-size:.72rem;color:rgba(255,255,255,.5);">Check-out</div><div style="font-size:.72rem;font-weight:600;color:#fff;" id="nbs-co">â€”</div>
                <div style="font-size:.75rem;font-weight:700;color:rgba(255,255,255,.6);border-top:1px solid rgba(255,255,255,.1);padding-top:.4rem;margin-top:.2rem;">Total Due</div>
                <div style="font-size:1.1rem;font-weight:800;color:var(--gold);border-top:1px solid rgba(255,255,255,.1);padding-top:.4rem;margin-top:.2rem;" id="nbs-tot">â‚±1,999</div>
              </div>
            </div>

            <div style="display:flex;gap:.7rem;">
              <button class="btn btn-primary btn-lg" onclick="submitNewBooking()">âœ“ Confirm Reservation</button>
              <button class="btn btn-ghost btn-lg" onclick="clearNBForm()">Clear Form</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â–‘â–‘â–‘â–‘â–‘â–‘â–‘ PAGE: CALENDAR â–‘â–‘â–‘â–‘â–‘â–‘â–‘ -->
    <div class="page" id="page-calendar">
      <div class="row cols-3-1">
        <div class="panel">
          <div class="panel-hd">
            <div class="panel-hd-left"><div class="ph-title">Booking Calendar</div><div class="ph-sub">Color-coded room occupancy</div></div>
            <div class="panel-hd-actions">
              <button class="cal-nav" onclick="prevCalMonth()">â€¹</button>
              <span class="cal-month-label" id="cal-month-lbl" style="margin:0 .5rem;"></span>
              <button class="cal-nav" onclick="nextCalMonth()">â€º</button>
            </div>
          </div>
          <div class="panel-body">
            <div class="cal-grid" id="cal-grid"></div>
            <div style="display:flex;gap:1.2rem;margin-top:1.1rem;flex-wrap:wrap;">
              <div style="display:flex;align-items:center;gap:.4rem;font-size:.7rem;color:var(--text3);"><div style="width:12px;height:12px;border-radius:3px;background:var(--amber)"></div>Today</div>
              <div style="display:flex;align-items:center;gap:.4rem;font-size:.7rem;color:var(--text3);"><div style="width:12px;height:12px;border-radius:3px;background:#FEE2E2;border:1px solid #FCA5A5"></div>Both Booked</div>
              <div style="display:flex;align-items:center;gap:.4rem;font-size:.7rem;color:var(--text3);"><div style="width:12px;height:12px;border-radius:3px;background:#FEF9C3;border:1px solid #FCD34D"></div>1 Suite Left</div>
              <div style="display:flex;align-items:center;gap:.4rem;font-size:.7rem;color:var(--text3);"><div style="width:12px;height:12px;border-radius:3px;background:var(--green-lt);border:1px solid #86EFAC"></div>Available</div>
            </div>
          </div>
        </div>
        <div style="display:flex;flex-direction:column;gap:1.1rem;">
          <div class="panel">
            <div class="panel-hd"><div class="panel-hd-left"><div class="ph-title">Selected Date</div></div></div>
            <div class="panel-body" id="cal-day-detail">
              <div class="empty"><div class="empty-ico">ğŸ“…</div><p>Click a date to see bookings</p></div>
            </div>
          </div>
          <div class="panel">
            <div class="panel-hd"><div class="panel-hd-left"><div class="ph-title">Month Summary</div></div></div>
            <div class="panel-body" id="cal-month-summary"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- â–‘â–‘â–‘â–‘â–‘â–‘â–‘ PAGE: GUESTS â–‘â–‘â–‘â–‘â–‘â–‘â–‘ -->
    <div class="page" id="page-guests">
      <div class="row cols-2">
        <div class="panel">
          <div class="panel-hd">
            <div class="panel-hd-left"><div class="ph-title">Guest Directory</div><div class="ph-sub">All guests who have made reservations</div></div>
          </div>
          <div class="panel-body" style="padding-bottom:.5rem;">
            <input type="text" id="guest-search" placeholder="ğŸ”  Search guests..." oninput="filterGuests()"
              style="width:100%;border:1.5px solid var(--border);border-radius:.45rem;padding:.55rem .9rem;font-family:'Plus Jakarta Sans',sans-serif;font-size:.8rem;outline:none;background:var(--snow);margin-bottom:.9rem;">
          </div>
          <div id="guest-list" style="padding:0 1.25rem 1.25rem;max-height:520px;overflow-y:auto;"></div>
        </div>
        <div class="panel">
          <div class="panel-hd"><div class="panel-hd-left"><div class="ph-title" id="guest-detail-title">Guest Details</div></div></div>
          <div class="panel-body" id="guest-detail">
            <div class="empty"><div class="empty-ico">ğŸ‘¤</div><p>Select a guest to view their history</p></div>
          </div>
        </div>
      </div>
    </div>

    <!-- â–‘â–‘â–‘â–‘â–‘â–‘â–‘ PAGE: ROOMS â–‘â–‘â–‘â–‘â–‘â–‘â–‘ -->
    <div class="page" id="page-rooms">
      <div class="row cols-2" style="margin-bottom:1.1rem;">
        <div class="panel" id="room1-panel"></div>
        <div class="panel" id="room2-panel"></div>
      </div>
      <div class="panel">
        <div class="panel-hd"><div class="panel-hd-left"><div class="ph-title">Room Amenities & Details</div></div></div>
        <div class="panel-body">
          <div class="row cols-2">
            <div>
              <div class="section-label">Suite 1 Â· Sunset Suite</div>
              <div class="fg-row">
                <div class="fg"><label>Room Name</label><input type="text" id="r1-name" value="Sunset Suite"></div>
                <div class="fg"><label>Max Guests</label><input type="number" value="4" readonly style="background:var(--linen)"></div>
              </div>
              <div class="fg"><label>Description</label><textarea id="r1-desc">King bed room with warm interiors, perfect for families and couples. Includes dining area and full private bath.</textarea></div>
              <div class="fg"><label>Amenities (comma separated)</label><input type="text" id="r1-amen" value="Air-conditioning, Smart TV, Hot Shower, Mini Bar, Free Wifi, Private Bath, Dining Area"></div>
              <button class="btn btn-primary btn-md" onclick="saveRoom(1)">Save Suite 1</button>
            </div>
            <div>
              <div class="section-label">Suite 2 Â· Oceana Suite</div>
              <div class="fg-row">
                <div class="fg"><label>Room Name</label><input type="text" id="r2-name" value="Oceana Suite"></div>
                <div class="fg"><label>Max Guests</label><input type="number" value="4" readonly style="background:var(--linen)"></div>
              </div>
              <div class="fg"><label>Description</label><textarea id="r2-desc">Queen bed suite with serene vibes, natural light, and tropical touches. Ideal for small groups.</textarea></div>
              <div class="fg"><label>Amenities (comma separated)</label><input type="text" id="r2-amen" value="Air-conditioning, Smart TV, Hot Shower, Mini Bar, Free Wifi, Private Bath, Bedroom Set"></div>
              <button class="btn btn-primary btn-md" onclick="saveRoom(2)">Save Suite 2</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â–‘â–‘â–‘â–‘â–‘â–‘â–‘ PAGE: PRICING â–‘â–‘â–‘â–‘â–‘â–‘â–‘ -->
    <div class="page" id="page-pricing">
      <div class="row cols-2">
        <div class="panel">
          <div class="panel-hd"><div class="panel-hd-left"><div class="ph-title">Base Pricing</div><div class="ph-sub">Applied to all bookings by default</div></div></div>
          <div class="panel-body">
            <div class="fg"><label>Standard Rate (â‚± per booking)</label>
              <input type="number" id="pr-rate" value="1999">
              <div class="fg-hint">This applies to both suites</div>
            </div>
            <div class="fg"><label>Stay Duration (hours)</label>
              <input type="number" id="pr-hrs" value="21">
              <div class="fg-hint">Check-out = check-in + this many hours</div>
            </div>
            <div class="fg"><label>Minimum Guests</label><input type="number" id="pr-minpx" value="1"></div>
            <div class="fg"><label>Maximum Guests Per Room</label><input type="number" id="pr-maxpx" value="4"></div>
            <button class="btn btn-primary btn-md" onclick="savePricing()">Save Pricing</button>
          </div>
        </div>
        <div class="panel">
          <div class="panel-hd"><div class="panel-hd-left"><div class="ph-title">Booking Policies</div></div></div>
          <div class="panel-body">
            <div class="fg"><label>Cancellation Policy</label>
              <select id="pr-cancel">
                <option value="flexible">Flexible â€” Full refund if cancelled before check-in</option>
                <option value="moderate">Moderate â€” 50% refund if cancelled 24hrs before</option>
                <option value="strict">Strict â€” No refund</option>
              </select>
            </div>
            <div class="fg"><label>Check-in Instructions</label>
              <textarea id="pr-checkin-note" placeholder="e.g. Call the owner upon arrival. Gate code: ####">Call the owner upon arrival. Gate code will be shared on confirmation.</textarea>
            </div>
            <div class="fg"><label>House Rules</label>
              <textarea id="pr-rules" placeholder="e.g. No pets, no outside visitorsâ€¦">No smoking inside. No pets. No outside visitors. Quiet hours: 10PMâ€“7AM.</textarea>
            </div>
            <button class="btn btn-primary btn-md" onclick="savePolicies()">Save Policies</button>
          </div>
        </div>
      </div>
      <!-- Special dates -->
      <div class="panel">
        <div class="panel-hd">
          <div class="panel-hd-left"><div class="ph-title">Blocked Dates</div><div class="ph-sub">Mark dates as unavailable (maintenance, personal use)</div></div>
          <div class="panel-hd-actions"><button class="btn btn-primary btn-sm" onclick="addBlockedDate()">+ Add Date</button></div>
        </div>
        <div class="panel-body">
          <div id="blocked-dates-list"></div>
          <div style="display:flex;gap:.7rem;align-items:flex-end;flex-wrap:wrap;margin-top:.5rem;" id="blocked-date-form" style="display:none;">
            <div class="fg" style="flex:1;margin:0;min-width:160px;"><label>Date</label><input type="date" id="bd-date"></div>
            <div class="fg" style="flex:1;margin:0;min-width:160px;"><label>Suite</label>
              <select id="bd-rm"><option value="both">Both Suites</option><option value="1">Suite 1 only</option><option value="2">Suite 2 only</option></select>
            </div>
            <div class="fg" style="flex:2;margin:0;min-width:180px;"><label>Reason</label><input type="text" id="bd-reason" placeholder="Maintenance, personal useâ€¦"></div>
            <button class="btn btn-primary btn-md" onclick="saveBlockedDate()">Add</button>
          </div>
        </div>
      </div>
    </div>

    <!-- â–‘â–‘â–‘â–‘â–‘â–‘â–‘ PAGE: ACTIVITY LOG â–‘â–‘â–‘â–‘â–‘â–‘â–‘ -->
    <div class="page" id="page-activity">
      <div class="panel">
        <div class="panel-hd">
          <div class="panel-hd-left"><div class="ph-title">Activity Log</div><div class="ph-sub">All admin actions and booking events</div></div>
          <div class="panel-hd-actions">
            <button class="btn btn-ghost btn-sm" onclick="clearLog()">Clear Log</button>
          </div>
        </div>
        <div id="activity-log" style="max-height:600px;overflow-y:auto;"></div>
      </div>
    </div>

    <!-- â–‘â–‘â–‘â–‘â–‘â–‘â–‘ PAGE: SETTINGS â–‘â–‘â–‘â–‘â–‘â–‘â–‘ -->
    <div class="page" id="page-settings">
      <div class="panel">
        <div class="panel-hd"><div class="panel-hd-left"><div class="ph-title">Settings</div></div></div>
        <div class="panel-body">
          <div class="stabs" id="stabs" style="margin-bottom:1.4rem;">
            <button class="stab active" onclick="switchStab(0,this)">ğŸ¢ Property</button>
            <button class="stab" onclick="switchStab(1,this)">ğŸ‘¤ Account</button>
            <button class="stab" onclick="switchStab(2,this)">ğŸ”” Notifications</button>
            <button class="stab" onclick="switchStab(3,this)">ğŸ’¾ Data</button>
            <button class="stab" onclick="switchStab(4,this)">ğŸŒ Website</button>
          </div>

          <!-- Tab 0: Property -->
          <div class="stab-pane active" id="stab-0">
            <div class="fg-row">
              <div class="fg"><label>Property Name</label><input type="text" id="s-propname" value="Espacio Norte AirBNB"></div>
              <div class="fg"><label>Property Type</label><select id="s-proptype"><option>Vacation Rental</option><option>Bed & Breakfast</option><option>Guesthouse</option></select></div>
            </div>
            <div class="fg-row">
              <div class="fg"><label>Address</label><input type="text" id="s-addr" placeholder="Street, City, Province"></div>
              <div class="fg"><label>Location / Area</label><input type="text" id="s-loc" placeholder="e.g. Near Sta. Cruz Beach"></div>
            </div>
            <div class="fg-row">
              <div class="fg"><label>Primary Phone</label><input type="tel" id="s-phone" placeholder="+63 9XX XXX XXXX"></div>
              <div class="fg"><label>Email</label><input type="email" id="s-email" placeholder="owner@email.com"></div>
            </div>
            <div class="fg-row">
              <div class="fg"><label>Facebook Page URL</label><input type="text" id="s-fb" placeholder="https://facebook.com/..."></div>
              <div class="fg"><label>Airbnb Listing URL</label><input type="text" id="s-airbnb" placeholder="https://airbnb.com/rooms/..."></div>
            </div>
            <div class="fg-row">
              <div class="fg"><label>GCash Number</label><input type="tel" id="s-gcash" placeholder="+63 9XX XXX XXXX"></div>
              <div class="fg"><label>Instagram</label><input type="text" id="s-ig" placeholder="@espacionorte"></div>
            </div>
            <button class="btn btn-primary btn-md" onclick="saveSettings()">Save Property Info</button>
          </div>

          <!-- Tab 1: Account -->
          <div class="stab-pane" id="stab-1">
            <div class="section-label">Admin Account</div>
            <div class="fg-row">
              <div class="fg"><label>Display Name</label><input type="text" id="s-name" value="Admin"></div>
              <div class="fg"><label>Role</label><input type="text" value="Property Manager" readonly style="background:var(--linen)"></div>
            </div>
            <div class="section-label">Change Password</div>
            <div class="fg-row-3">
              <div class="fg"><label>Current Password</label><input type="password" id="s-pw-curr" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
              <div class="fg"><label>New Password</label><input type="password" id="s-pw-new" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
              <div class="fg"><label>Confirm New Password</label><input type="password" id="s-pw-conf" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
            </div>
            <button class="btn btn-primary btn-md" onclick="saveAccount()">Save Account</button>
          </div>

          <!-- Tab 2: Notifications -->
          <div class="stab-pane" id="stab-2">
            <div class="section-label">Notification Preferences</div>
            <div class="toggle-wrap"><button class="toggle on" id="notif-new" onclick="this.classList.toggle('on')"></button><span class="toggle-label">New booking created</span></div>
            <div class="toggle-wrap"><button class="toggle on" id="notif-cancel" onclick="this.classList.toggle('on')"></button><span class="toggle-label">Booking cancelled</span></div>
            <div class="toggle-wrap"><button class="toggle on" id="notif-checkin" onclick="this.classList.toggle('on')"></button><span class="toggle-label">Guest check-in reminder (1 hr before)</span></div>
            <div class="toggle-wrap"><button class="toggle" id="notif-report" onclick="this.classList.toggle('on')"></button><span class="toggle-label">Weekly summary report</span></div>
            <div class="toggle-wrap"><button class="toggle" id="notif-lowbook" onclick="this.classList.toggle('on')"></button><span class="toggle-label">Low booking alert (less than 2 bookings this week)</span></div>
            <div style="margin-top:1rem;"><button class="btn btn-primary btn-md" onclick="showToast('Notification preferences saved','âœ…','t-ok')">Save Preferences</button></div>
          </div>

          <!-- Tab 3: Data -->
          <div class="stab-pane" id="stab-3">
            <div class="section-label">Export Data</div>
            <p style="font-size:.8rem;color:var(--text2);line-height:1.7;margin-bottom:1rem;">Export your bookings as a CSV file that you can open in Excel or Google Sheets. Do this regularly as a backup.</p>
            <div style="display:flex;gap:.7rem;flex-wrap:wrap;margin-bottom:1.5rem;">
              <button class="btn btn-primary btn-md" onclick="exportCSV()">ğŸ“¥ Export All Bookings (CSV)</button>
              <button class="btn btn-ghost btn-md" onclick="exportCSVMonth()">ğŸ“¥ Export This Month</button>
            </div>
            <div class="section-label">Import / Restore</div>
            <p style="font-size:.8rem;color:var(--text2);line-height:1.7;margin-bottom:.75rem;">Paste previously exported booking JSON data to restore records.</p>
            <div class="fg"><label>Paste JSON data</label><textarea id="import-data" placeholder='[{"ref":"EN-..."}]' style="min-height:100px;font-family:monospace;font-size:.75rem;"></textarea></div>
            <button class="btn btn-ghost btn-md" onclick="importData()" style="margin-bottom:1.5rem;">Import Data</button>
            <div class="section-label" style="color:var(--red);">Danger Zone</div>
            <p style="font-size:.78rem;color:var(--text3);margin-bottom:.75rem;">These actions are permanent and cannot be undone.</p>
            <div style="display:flex;gap:.7rem;flex-wrap:wrap;">
              <button class="btn btn-danger btn-md" onclick="clearCancelled()">ğŸ—‘ï¸ Delete Cancelled Bookings</button>
              <button class="btn btn-danger btn-md" onclick="clearAllData()">âš ï¸ Delete ALL Data</button>
            </div>
          </div>

          <!-- Tab 4: Website -->
          <div class="stab-pane" id="stab-4">
            <div class="section-label">Website Appearance</div>
            <div class="fg"><label>Hero Tagline</label><input type="text" id="ws-tagline" value="Your Home Away From Home" placeholder="Main headline on homepage"></div>
            <div class="fg"><label>Hero Subtext</label><textarea id="ws-sub" placeholder="Short description shown below the headline">A beautifully crafted retreat where modern comfort meets warm, tropical living.</textarea></div>
            <div class="fg"><label>Footer Contact Info</label><input type="text" id="ws-footer" placeholder="Phone, address, or message shown in footer"></div>
            <div class="section-label">Booking Site</div>
            <div class="toggle-wrap"><button class="toggle on" onclick="this.classList.toggle('on')"></button><span class="toggle-label">Allow online bookings (public booking site active)</span></div>
            <div class="toggle-wrap"><button class="toggle on" onclick="this.classList.toggle('on')"></button><span class="toggle-label">Show pricing on website</span></div>
            <div class="toggle-wrap"><button class="toggle" onclick="this.classList.toggle('on')"></button><span class="toggle-label">Maintenance mode (hide website from public)</span></div>
            <div style="margin-top:1rem;">
              <button class="btn btn-primary btn-md" onclick="showToast('Website settings saved','âœ…','t-ok')">Save Website Settings</button>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /content -->
</div><!-- /main -->

<!-- BOOKING DETAIL MODAL -->
<div class="modal-bg" id="bk-modal" onclick="closeBkModal(event)">
  <div class="modal modal-lg">
    <div class="modal-hd">
      <h3 id="bk-modal-title">Booking Details</h3>
      <button class="modal-close-btn" onclick="document.getElementById('bk-modal').classList.remove('open')">âœ•</button>
    </div>
    <div class="modal-body" id="bk-modal-body"></div>
    <div class="modal-ft" id="bk-modal-ft"></div>
  </div>
</div>

<!-- BLOCKED DATE FORM (shown inline) -->

<!-- TOAST -->
<div class="toast" id="toast"><span id="toast-ico">â„¹ï¸</span><span id="toast-msg"></span></div>

<script>
'use strict';
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONSTANTS & STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BK_KEY  = 'en3';
const LOG_KEY = 'en3_log';
const CFG_KEY = 'en3_cfg';
const RATE    = 1999;
const MFull   = ['January','February','March','April','May','June','July','August','September','October','November','December'];
const M3      = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
const D3      = ['Su','Mo','Tu','We','Th','Fr','Sa'];

let BK  = [];
let LOG = [];
let CFG = {};
let calDate  = new Date();
let blockedDates = [];
let notifs   = [];
let bdFormVisible = false;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function init() {
  loadAll();
  seedIfEmpty();
  setTopbarDate();
  renderAll();
  setInterval(()=>{ renderLiveRooms(); renderDashStatsBar(); }, 30000);
}

function loadAll() {
  try{ BK  = JSON.parse(localStorage.getItem(BK_KEY)  || '[]'); }catch(e){BK=[];}
  try{ LOG = JSON.parse(localStorage.getItem(LOG_KEY) || '[]'); }catch(e){LOG=[];}
  try{ CFG = JSON.parse(localStorage.getItem(CFG_KEY) || '{}'); }catch(e){CFG={};}
  blockedDates = CFG.blockedDates || [];
  document.getElementById('admin-display-name').textContent = CFG.adminName || 'Admin';
}
function saveAll() {
  localStorage.setItem(BK_KEY,  JSON.stringify(BK));
  localStorage.setItem(LOG_KEY, JSON.stringify(LOG));
  CFG.blockedDates = blockedDates;
  localStorage.setItem(CFG_KEY, JSON.stringify(CFG));
}

function renderAll() {
  renderDashboard();
  renderBarChart();
  renderDonut();
  renderLiveRooms();
  renderDashRecent();
  renderDashUpcoming();
  renderPendingBadge();
  renderNotifs();
  renderBlockedDates();
  renderActivityLog();
  renderCalendar();
  renderCalMonthSummary();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DEMO SEED
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function dayFromNow(d, h=14) {
  const dt = new Date(); dt.setDate(dt.getDate()+d); dt.setHours(h,0,0,0); return dt;
}
function mkBk(fn,ln,ph,rm,dOff,h,px,st,note='',pay='cash'){
  const ci=dayFromNow(dOff,h), co=new Date(ci.getTime()+21*3600000);
  return {ref:'EN-'+Math.random().toString(36).slice(2,8).toUpperCase(),fn,ln,ph,rm,ci:ci.toISOString(),co:co.toISOString(),px,st,nt:note,pay,created:new Date().toISOString()};
}
function seedIfEmpty() {
  if(BK.length>0) return;
  BK=[
    mkBk('Maria','Santos','+63 912 345 6789','1',-60,14,3,'checkedout','Anniversary setup'),
    mkBk('Jose','Reyes','+63 917 111 2222','2',-55,12,2,'checkedout','','gcash'),
    mkBk('Ana','Cruz','+63 918 222 3333','1',-48,14,4,'checkedout','Late check-in'),
    mkBk('Mark','Lopez','+63 919 333 4444','2',-40,15,2,'checkedout'),
    mkBk('Grace','Tan','+63 920 444 5555','1',-33,14,3,'checkedout','','bank'),
    mkBk('Carlo','Mendez','+63 921 555 6666','2',-28,16,2,'checkedout'),
    mkBk('Liza','Bautista','+63 922 666 7777','1',-22,13,4,'checkedout'),
    mkBk('Paolo','Garcia','+63 923 777 8888','2',-17,14,2,'checkedout','','gcash'),
    mkBk('Rhea','Flores','+63 924 888 9999','1',-10,14,3,'checkedout'),
    mkBk('Ian','Villanueva','+63 925 999 0000','2',-5,12,2,'checkedout'),
    mkBk('Bea','Santos','+63 926 000 1111','1',-3,14,4,'checkedout','Birthday celebration','paid'),
    mkBk('Rex','Aquino','+63 927 111 2222','2',-1,15,2,'checkedout'),
    mkBk('Nina','Ramos','+63 928 222 3333','1',0,14,3,'confirmed','Arriving by bus'),
    mkBk('Dan','Pascual','+63 929 333 4444','2',0,16,2,'confirmed'),
    mkBk('Tina','Navarro','+63 930 444 5555','1',2,13,4,'confirmed','Need extra bed if possible'),
    mkBk('Vic','Santiago','+63 931 555 6666','2',3,14,2,'pending','Awaiting GCash payment'),
    mkBk('Rose','Padilla','+63 932 666 7777','1',5,14,3,'confirmed','','bank'),
    mkBk('Ed','Aguilar','+63 933 777 8888','2',7,15,2,'pending'),
    mkBk('Cy','Soriano','+63 934 888 9999','1',10,14,4,'confirmed'),
    mkBk('Mia','Torres','+63 935 999 0000','2',12,14,2,'confirmed','','gcash'),
    mkBk('Leo','Dela Cruz','+63 936 000 1111','1',15,14,3,'confirmed'),
    mkBk('Ara','Santos','+63 912 111 1234','2',-90,14,2,'cancelled','Changed plans'),
  ];
  LOG=[
    {type:'ok',  msg:'Admin logged in', time: new Date(Date.now()-3*60000).toISOString()},
    {type:'ok',  msg:'New booking created â€” Nina Ramos (Suite 1)', time: new Date(Date.now()-2*60000).toISOString()},
    {type:'warn',msg:'Booking #EN-VIC001 set to Pending â€” awaiting payment', time: new Date(Date.now()-60000).toISOString()},
  ];
  saveAll();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PAGE_NAMES = {
  dashboard:'Dashboard', analytics:'Analytics & Reports', bookings:'All Bookings',
  'new-booking':'New Booking', calendar:'Booking Calendar', guests:'Guest Directory',
  rooms:'Room Management', pricing:'Pricing & Rules', activity:'Activity Log', settings:'Settings'
};

function goPage(id) {
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.sb-item').forEach(b=>b.classList.remove('active'));
  const pg = document.getElementById('page-'+id);
  if(pg) pg.classList.add('active');
  const btn = document.querySelector(`.sb-item[data-page="${id}"]`);
  if(btn) btn.classList.add('active');
  document.getElementById('topbar-title').textContent = PAGE_NAMES[id]||id;
  // Page-specific refresh
  if(id==='bookings')   { filterBookings(); }
  if(id==='analytics')  { buildReports(); }
  if(id==='calendar')   { renderCalendar(); renderCalMonthSummary(); }
  if(id==='guests')     { renderGuests(); }
  if(id==='rooms')      { renderRoomsPage(); }
  if(id==='activity')   { renderActivityLog(); }
  window.scrollTo(0,0);
}

document.querySelectorAll('.sb-item').forEach(btn => {
  btn.addEventListener('click', ()=> goPage(btn.dataset.page));
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDashboard() {
  renderDashStatsBar();
  renderDashRecent();
  renderDashUpcoming();
  renderLiveRooms();
  renderDonut();
}

function renderDashStatsBar() {
  const now = new Date();
  const thisMonth = BK.filter(b=>{ const d=new Date(b.ci); return d.getMonth()===now.getMonth() && d.getFullYear()===now.getFullYear() && b.st!=='cancelled'; });
  const lastMonth = BK.filter(b=>{ const d=new Date(b.ci); const lm=new Date(now.getFullYear(),now.getMonth()-1,1); return d.getMonth()===lm.getMonth() && d.getFullYear()===lm.getFullYear() && b.st!=='cancelled'; });
  const pending   = BK.filter(b=>b.st==='pending');
  const occ       = [1,2].filter(r=>isOccupied(r,now)).length;

  const rev  = thisMonth.length*RATE;
  const revL = lastMonth.length*RATE;
  const revDiff = revL>0 ? Math.round(((rev-revL)/revL)*100) : 0;

  setText('d-rev', `â‚±${rev.toLocaleString()}`);
  setText('d-bk', BK.filter(b=>b.st!=='cancelled').length);
  setText('d-occ', Math.round((occ/2)*100)+'%');
  setText('d-pend', pending.length);
  setText('d-rev-sub', `vs â‚±${revL.toLocaleString()} last month`);
  setText('d-bk-sub', `${thisMonth.length} this month`);
  setText('d-occ-sub', occ===0?'Both rooms free':occ===1?'1 of 2 rooms in use':'Both rooms occupied');

  const rt = document.getElementById('rev-trend');
  rt.textContent = (revDiff>=0?'+':'')+revDiff+'%';
  rt.className = 'sc-trend '+(revDiff>=0?'trend-up':'trend-dn');

  const bt = document.getElementById('bk-trend');
  bt.textContent = pending.length>0 ? `${pending.length} pending` : 'âœ“ All clear';
  bt.className = 'sc-trend '+(pending.length>0?'trend-neu':'trend-up');
  if(pending.length>0){bt.style.background='#FEF9C3';bt.style.color='#92400E';}
  else{bt.style.background='';bt.style.color='';}

  renderPendingBadge();
}

function renderDashRecent() {
  const list = [...BK].filter(b=>b.st!=='cancelled').sort((a,b)=>new Date(b.ci)-new Date(a.ci)).slice(0,6);
  const tb = document.getElementById('dash-recent');
  if(!list.length){tb.innerHTML=`<tr><td colspan="5" style="text-align:center;padding:2rem;color:var(--text4);font-style:italic;">No bookings yet</td></tr>`;return;}
  tb.innerHTML = list.map(b=>`<tr onclick="openBkModal('${b.ref}')" style="cursor:pointer;">
    <td><div style="font-weight:600;font-size:.8rem;">${b.fn} ${b.ln}</div><div style="font-size:.68rem;color:var(--text3);">${b.ph}</div></td>
    <td>Suite ${b.rm}</td>
    <td style="font-size:.73rem;white-space:nowrap;">${fmtShort(b.ci)}</td>
    <td>${pill(b.st)}</td>
    <td><button class="btn btn-sm btn-ghost" onclick="event.stopPropagation();openBkModal('${b.ref}')">View</button></td>
  </tr>`).join('');
}

function renderDashUpcoming() {
  const now = new Date();
  const list = BK.filter(b=>b.st!=='cancelled'&&new Date(b.ci)>now).sort((a,b)=>new Date(a.ci)-new Date(b.ci)).slice(0,5);
  const wrap = document.getElementById('dash-upcoming');
  if(!list.length){wrap.innerHTML=`<div class="empty"><div class="empty-ico">ğŸ“­</div><p>No upcoming check-ins</p></div>`;return;}
  wrap.innerHTML = list.map(b=>{
    const d=new Date(b.ci);
    return `<div class="upc-item" onclick="openBkModal('${b.ref}')" style="cursor:pointer;">
      <div class="upc-date-box"><div class="upc-dd">${d.getDate()}</div><div class="upc-mo">${M3[d.getMonth()]}</div></div>
      <div class="upc-info">
        <div class="upc-name">${b.fn} ${b.ln}</div>
        <div class="upc-meta">Suite ${b.rm} Â· ${b.px} guest${b.px>1?'s':''} Â· ${fmtTime(b.ci)}</div>
      </div>
      ${pill(b.st)}
    </div>`;
  }).join('');
}

function renderLiveRooms() {
  const now = new Date();
  const wrap = document.getElementById('live-rooms');
  if(!wrap)return;
  wrap.innerHTML = [1,2].map(r=>{
    const occ = isOccupied(r,now);
    const cur = BK.find(b=>b.rm==r&&b.st!=='cancelled'&&now>=new Date(b.ci)&&now<new Date(b.co));
    const names={1:'Sunset Suite',2:'Oceana Suite'};
    const pct = occ&&cur ? Math.min(100,Math.round(((now-new Date(cur.ci))/(new Date(cur.co)-new Date(cur.ci)))*100)) : 0;
    return `<div class="room-card-live ${occ?'occ':'avail'}">
      <div class="rcl-head">
        <div class="rcl-name">Suite ${r} Â· ${names[r]}</div>
        ${occ?'<span class="pill p-occupied">Occupied</span>':'<span class="pill p-available">Available</span>'}
      </div>
      <div class="rcl-body">
        ${occ&&cur
          ?`<div class="rcl-guest">ğŸ‘¤ ${cur.fn} ${cur.ln}</div>
            <div class="rcl-info">Check-out: ${fmtShort(cur.co)} Â· ${cur.px} guest${cur.px>1?'s':''}</div>
            <div class="rcl-progress"><div class="rcl-progress-fill" style="width:${pct}%"></div></div>`
          :`<div class="rcl-info" style="color:var(--green);font-weight:600;">âœ“ Ready for new guests</div>`
        }
      </div>
    </div>`;
  }).join('');
}

function renderDonut() {
  const now = new Date();
  const r1 = BK.filter(b=>b.rm=='1'&&b.st!=='cancelled'&&new Date(b.ci).getMonth()===now.getMonth()).length;
  const r2 = BK.filter(b=>b.rm=='2'&&b.st!=='cancelled'&&new Date(b.ci).getMonth()===now.getMonth()).length;
  const canc = BK.filter(b=>new Date(b.ci).getMonth()===now.getMonth()&&b.st==='cancelled').length;
  const total = r1+r2||1;
  const circ=220;
  const d1=Math.round((r1/total)*circ);
  const d2=Math.round((r2/total)*circ);
  const d1r2=circ-d1;
  document.getElementById('donut-r1').setAttribute('stroke-dasharray',`${d1} ${d1r2}`);
  document.getElementById('donut-r2').setAttribute('stroke-dasharray',`${d2} ${circ-d2}`);
  document.getElementById('donut-r2').setAttribute('stroke-dashoffset', 55-d1);
  setText('donut-v1',r1); setText('donut-v2',r2); setText('donut-vc',canc);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BAR CHART
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderBarChart() {
  const year = parseInt(document.getElementById('chart-year')?.value||new Date().getFullYear());
  const counts = M3.map((_,i)=>BK.filter(b=>{const d=new Date(b.ci);return d.getFullYear()===year&&d.getMonth()===i&&b.st!=='cancelled';}).length);
  const max = Math.max(...counts,1);
  const wrap = document.getElementById('bar-chart');
  const ya   = document.getElementById('y-axis');
  if(!wrap) return;
  ya.innerHTML = [max, Math.round(max/2), 0].map(v=>`<span>${v}</span>`).join('');
  const now = new Date();
  wrap.innerHTML = counts.map((c,i)=>{
    const pct=(c/max)*100, isPeak=c===max&&c>0;
    const isNow = i===now.getMonth()&&year===now.getFullYear();
    return `<div class="bar-col">
      <div class="bar-track" style="height:140px;">
        <div class="bar-fill${isPeak?' peak':''}" style="height:${pct}%;" data-tip="${M3[i]}: ${c} booking${c!==1?'s':''}"></div>
      </div>
      <div class="bar-lbl" style="${isNow?'color:var(--amber);font-weight:700;':''}">${M3[i]}</div>
    </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BOOKINGS PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function filterBookings() {
  const q    = (document.getElementById('bk-search')?.value||'').toLowerCase();
  const st   = document.getElementById('bk-status')?.value||'';
  const rm   = document.getElementById('bk-room')?.value||'';
  const mo   = document.getElementById('bk-month')?.value;

  let list = [...BK];
  if(q)    list=list.filter(b=>`${b.fn} ${b.ln} ${b.ph} ${b.ref}`.toLowerCase().includes(q));
  if(st)   list=list.filter(b=>b.st===st);
  if(rm)   list=list.filter(b=>b.rm==rm);
  if(mo!==''&&mo!==undefined) list=list.filter(b=>new Date(b.ci).getMonth()==parseInt(mo));
  list.sort((a,b)=>new Date(b.ci)-new Date(a.ci));

  setText('bk-count',`Showing ${list.length} of ${BK.length} bookings`);
  const tb=document.getElementById('bk-tbody');
  if(!list.length){tb.innerHTML=`<tr><td colspan="10" class="empty" style="padding:2.5rem;text-align:center;color:var(--text4);font-style:italic;">No bookings match your filters</td></tr>`;return;}
  tb.innerHTML=list.map(b=>{
    const idx=BK.findIndex(x=>x.ref===b.ref);
    return`<tr onclick="openBkModal('${b.ref}')" style="cursor:pointer;">
      <td style="font-family:monospace;font-size:.68rem;color:var(--text3);">${b.ref}</td>
      <td><div style="font-weight:600;">${b.fn} ${b.ln}</div><div style="font-size:.68rem;color:var(--text3);">${b.ph}</div></td>
      <td>Suite ${b.rm}</td>
      <td style="white-space:nowrap;font-size:.75rem;">${fmtShort(b.ci)}</td>
      <td style="white-space:nowrap;font-size:.75rem;">${fmtShort(b.co)}</td>
      <td>${b.px}</td>
      <td style="font-weight:700;">â‚±${RATE.toLocaleString()}</td>
      <td style="font-size:.73rem;text-transform:capitalize;">${b.pay||'â€”'}</td>
      <td>${pill(b.st)}</td>
      <td onclick="event.stopPropagation();">
        <div style="display:flex;gap:.3rem;">
          ${b.st==='pending'||b.st==='confirmed'?`<button class="btn btn-sm" style="background:var(--green-lt);color:var(--green);border:1px solid #86EFAC;" onclick="doCheckIn(${idx})">âœ“ In</button>`:''}
          ${b.st==='checkedin'?`<button class="btn btn-sm" style="background:var(--blue-lt);color:var(--blue);border:1px solid #93C5FD;" onclick="doCheckOut(${idx})">Out</button>`:''}
          ${b.st!=='cancelled'&&b.st!=='checkedout'?`<button class="btn btn-sm btn-danger" onclick="doCancel(${idx})">âœ•</button>`:''}
        </div>
      </td>
    </tr>`;
  }).join('');
}

function clearFilters(){
  ['bk-search','bk-status','bk-room','bk-month'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
  filterBookings();
}

function doCheckIn(i){
  if(!confirm(`Check in ${BK[i].fn} ${BK[i].ln}?`))return;
  BK[i].st='checkedin'; addLog('ok',`${BK[i].fn} ${BK[i].ln} checked in â€” Suite ${BK[i].rm}`);
  saveAll(); filterBookings(); renderDashboard();
  showToast(`${BK[i].fn} ${BK[i].ln} checked in!`,'ğŸ ','t-ok');
}
function doCheckOut(i){
  if(!confirm(`Check out ${BK[i].fn} ${BK[i].ln}?`))return;
  BK[i].st='checkedout'; addLog('ok',`${BK[i].fn} ${BK[i].ln} checked out â€” Suite ${BK[i].rm}`);
  saveAll(); filterBookings(); renderDashboard();
  showToast(`${BK[i].fn} ${BK[i].ln} checked out`,'ğŸ‘‹','t-ok');
}
function doCancel(i){
  if(!confirm(`Cancel booking for ${BK[i].fn} ${BK[i].ln}? This cannot be undone.`))return;
  BK[i].st='cancelled'; addLog('warn',`Booking cancelled â€” ${BK[i].fn} ${BK[i].ln} (${BK[i].ref})`);
  addNotif(`Booking for ${BK[i].fn} ${BK[i].ln} was cancelled`,'red');
  saveAll(); filterBookings(); renderDashboard();
  showToast('Booking cancelled','âŒ','t-err');
}

// Booking detail modal
function openBkModal(ref) {
  const b = BK.find(x=>x.ref===ref); if(!b) return;
  const idx = BK.indexOf(b);
  document.getElementById('bk-modal-title').textContent = `Booking Â· ${b.ref}`;
  document.getElementById('bk-modal-body').innerHTML=`
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:.75rem;margin-bottom:1rem;">
      <div style="background:var(--linen);border-radius:.5rem;padding:.9rem;">
        <div style="font-size:.6rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--text3);margin-bottom:.3rem;">Guest</div>
        <div style="font-weight:700;font-size:.9rem;">${b.fn} ${b.ln}</div>
        <div style="font-size:.75rem;color:var(--text2);margin-top:.18rem;">ğŸ“ ${b.ph}</div>
        ${b.email?`<div style="font-size:.73rem;color:var(--text2);">âœ‰ï¸ ${b.email}</div>`:''}
        ${b.fb?`<div style="font-size:.73rem;color:var(--text2);">ğŸ“˜ ${b.fb}</div>`:''}
      </div>
      <div style="background:var(--linen);border-radius:.5rem;padding:.9rem;">
        <div style="font-size:.6rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--text3);margin-bottom:.3rem;">Reservation</div>
        <div style="font-weight:700;font-size:.9rem;">Suite ${b.rm}</div>
        <div style="font-size:.75rem;color:var(--text2);margin-top:.18rem;">ğŸ‘¥ ${b.px} guest${b.px>1?'s':''}</div>
        <div style="font-size:.73rem;color:var(--text2);">ğŸ’³ ${b.pay||'Not specified'}</div>
      </div>
      <div style="background:var(--linen);border-radius:.5rem;padding:.9rem;">
        <div style="font-size:.6rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--text3);margin-bottom:.3rem;">Check-in</div>
        <div style="font-weight:700;">${fmtFull(b.ci)}</div>
      </div>
      <div style="background:var(--linen);border-radius:.5rem;padding:.9rem;">
        <div style="font-size:.6rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--text3);margin-bottom:.3rem;">Check-out</div>
        <div style="font-weight:700;">${fmtFull(b.co)}</div>
      </div>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;background:linear-gradient(135deg,var(--forest-dk),var(--forest));border-radius:.5rem;padding:1rem 1.1rem;margin-bottom:.75rem;">
      <div>${pill(b.st)}</div>
      <div style="font-size:1.3rem;font-weight:800;color:var(--gold);">â‚±${RATE.toLocaleString()}</div>
    </div>
    ${b.nt?`<div style="background:#FFFBEB;border:1px solid #FCD34D;border-radius:.45rem;padding:.8rem 1rem;margin-bottom:.75rem;font-size:.8rem;line-height:1.6;"><span style="font-weight:700;">ğŸ’¬ Notes:</span> ${b.nt}</div>`:''}
    <div style="font-size:.68rem;color:var(--text4);">Reference: ${b.ref} Â· Created: ${b.created?fmtFull(b.created):'N/A'}</div>
  `;
  document.getElementById('bk-modal-ft').innerHTML=`
    <div style="display:flex;gap:.5rem;flex-wrap:wrap;">
      ${b.st==='pending'||b.st==='confirmed'?`<button class="btn btn-primary btn-md" onclick="doCheckIn(${idx});document.getElementById('bk-modal').classList.remove('open')">âœ“ Check In</button>`:''}
      ${b.st==='checkedin'?`<button class="btn btn-md" style="background:var(--blue-lt);color:var(--blue);" onclick="doCheckOut(${idx});document.getElementById('bk-modal').classList.remove('open')">ğŸšª Check Out</button>`:''}
      ${b.st!=='cancelled'&&b.st!=='checkedout'?`<button class="btn btn-danger btn-md" onclick="doCancel(${idx});document.getElementById('bk-modal').classList.remove('open')">âœ• Cancel Booking</button>`:''}
      <button class="btn btn-ghost btn-md" onclick="document.getElementById('bk-modal').classList.remove('open')">Close</button>
    </div>`;
  document.getElementById('bk-modal').classList.add('open');
}
function closeBkModal(e){if(e.target===e.currentTarget)document.getElementById('bk-modal').classList.remove('open');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NEW BOOKING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function nbCalc(){
  const rm=document.getElementById('nb-rm').value;
  const ci=document.getElementById('nb-ci').value;
  const rn={'1':'Suite 1 Â· Sunset Suite','2':'Suite 2 Â· Oceana Suite'};
  document.getElementById('nbs-rm').textContent=rm?rn[rm]:'â€”';
  if(ci){
    const d=new Date(ci),co=new Date(d.getTime()+21*3600000);
    document.getElementById('nb-co').value=co.toLocaleString('en-PH',{month:'short',day:'numeric',year:'numeric',hour:'2-digit',minute:'2-digit'});
    document.getElementById('nbs-ci').textContent=fmtFull(d);
    document.getElementById('nbs-co').textContent=fmtFull(co);
  }
}
function submitNewBooking(){
  const fn=g('nb-fn').value.trim(),ln=g('nb-ln').value.trim(),ph=g('nb-ph').value.trim();
  const ci=g('nb-ci').value,rm=g('nb-rm').value,px=parseInt(g('nb-px').value)||1;
  const nt=g('nb-note').value.trim(),pay=g('nb-pay').value,st=g('nb-st').value;
  const em=g('nb-em').value.trim(),fb=g('nb-fb').value.trim();
  if(!fn||!ln||!ph||!ci||!rm){showToast('Please fill all required fields','âš ï¸','t-err');return;}
  if(px<1||px>4){showToast('Guests must be 1â€“4','âš ï¸','t-err');return;}
  const cid=new Date(ci),cod=new Date(cid.getTime()+21*3600000);
  const conflict=BK.some(b=>{if(b.rm!=rm||b.st==='cancelled')return false;return cid<new Date(b.co)&&cod>new Date(b.ci);});
  if(conflict){showToast(`Suite ${rm} already booked at that time. Choose another date or suite.`,'âŒ','t-err');return;}
  const ref='EN-'+Date.now().toString(36).toUpperCase();
  BK.push({ref,fn,ln,ph,em,fb,rm,ci:cid.toISOString(),co:cod.toISOString(),px,nt,pay,st,created:new Date().toISOString()});
  addLog('ok',`New booking created â€” ${fn} ${ln} (Suite ${rm}, ${fmtShort(cid)})`);
  addNotif(`New booking: ${fn} ${ln} â€” Suite ${rm}`,'green');
  saveAll(); clearNBForm(); renderAll();
  showToast(`Booking confirmed for ${fn} ${ln}!`,'âœ…','t-ok');
  setTimeout(()=>goPage('bookings'),1000);
}
function clearNBForm(){
  ['nb-fn','nb-ln','nb-ph','nb-em','nb-fb','nb-ci','nb-co','nb-note'].forEach(id=>g(id)&&(g(id).value=''));
  g('nb-rm').value=''; g('nb-px').value=2; g('nb-pay').value='cash'; g('nb-st').value='confirmed';
  ['nbs-rm','nbs-ci','nbs-co'].forEach(id=>setText(id,'â€”'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CALENDAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCalendar(){
  const wrap=document.getElementById('cal-grid'); if(!wrap)return;
  document.getElementById('cal-month-lbl').textContent=`${MFull[calDate.getMonth()]} ${calDate.getFullYear()}`;
  const first=new Date(calDate.getFullYear(),calDate.getMonth(),1).getDay();
  const days=new Date(calDate.getFullYear(),calDate.getMonth()+1,0).getDate();
  const now=new Date();
  wrap.innerHTML=D3.map(d=>`<div class="cal-dname">${d}</div>`).join('');
  for(let i=0;i<first;i++) wrap.innerHTML+=`<div class="cal-day cal-empty"></div>`;
  for(let d=1;d<=days;d++){
    const dt=new Date(calDate.getFullYear(),calDate.getMonth(),d);
    const isT=dt.toDateString()===now.toDateString();
    const occ1=isOccupied(1,dt),occ2=isOccupied(2,dt);
    const isPast=dt<now&&!isT;
    let cls='cal-day',bg='',extra='';
    if(isT){cls+=' cal-today';}
    else if(occ1&&occ2){cls+=' cal-full';}
    else if(occ1||occ2){cls+=' cal-partial';}
    else if(isPast){cls+=' cal-past';}
    wrap.innerHTML+=`<div class="${cls}" onclick="showCalDay(${d})" title="${occ1&&occ2?'Both booked':occ1||occ2?'1 suite booked':'Available'}">${d}</div>`;
  }
}
function prevCalMonth(){calDate.setMonth(calDate.getMonth()-1);renderCalendar();renderCalMonthSummary();}
function nextCalMonth(){calDate.setMonth(calDate.getMonth()+1);renderCalendar();renderCalMonthSummary();}

function showCalDay(d){
  const dt=new Date(calDate.getFullYear(),calDate.getMonth(),d);
  const dayBks=BK.filter(b=>b.st!=='cancelled'&&new Date(b.ci)<=dt&&new Date(b.co)>dt);
  const wrap=document.getElementById('cal-day-detail');
  wrap.innerHTML=`<div style="font-size:.78rem;font-weight:700;margin-bottom:.9rem;">${MFull[dt.getMonth()]} ${d}, ${dt.getFullYear()}</div>`;
  if(!dayBks.length){wrap.innerHTML+=`<div style="font-size:.8rem;color:var(--text3);font-style:italic;">No bookings on this date</div>`;return;}
  dayBks.forEach(b=>{
    wrap.innerHTML+=`<div onclick="openBkModal('${b.ref}')" style="background:var(--linen);border-radius:.45rem;padding:.75rem .9rem;margin-bottom:.5rem;cursor:pointer;border:1px solid var(--border);">
      <div style="font-weight:700;font-size:.82rem;">${b.fn} ${b.ln}</div>
      <div style="font-size:.73rem;color:var(--text3);margin-top:.15rem;">Suite ${b.rm} Â· ${b.px} guests Â· ${pill(b.st)}</div>
    </div>`;
  });
}
function renderCalMonthSummary(){
  const wrap=document.getElementById('cal-month-summary'); if(!wrap)return;
  const bks=BK.filter(b=>{const d=new Date(b.ci);return d.getMonth()===calDate.getMonth()&&d.getFullYear()===calDate.getFullYear()&&b.st!=='cancelled';});
  wrap.innerHTML=`
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:.6rem;">
      <div style="background:var(--linen);border-radius:.4rem;padding:.7rem;text-align:center;"><div style="font-size:1.3rem;font-weight:800;color:var(--forest);">${bks.length}</div><div style="font-size:.65rem;color:var(--text3);">Bookings</div></div>
      <div style="background:var(--linen);border-radius:.4rem;padding:.7rem;text-align:center;"><div style="font-size:1.3rem;font-weight:800;color:var(--amber);">â‚±${(bks.length*RATE).toLocaleString()}</div><div style="font-size:.65rem;color:var(--text3);">Revenue</div></div>
      <div style="background:var(--linen);border-radius:.4rem;padding:.7rem;text-align:center;"><div style="font-size:1.3rem;font-weight:800;color:var(--blue);">${bks.filter(b=>b.rm==1).length}</div><div style="font-size:.65rem;color:var(--text3);">Suite 1</div></div>
      <div style="background:var(--linen);border-radius:.4rem;padding:.7rem;text-align:center;"><div style="font-size:1.3rem;font-weight:800;color:var(--sage);">${bks.filter(b=>b.rm==2).length}</div><div style="font-size:.65rem;color:var(--text3);">Suite 2</div></div>
    </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ANALYTICS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildReports(){
  const year=parseInt(document.getElementById('rpt-year')?.value||new Date().getFullYear());
  const monthly=M3.map((_,i)=>{
    const bks=BK.filter(b=>{const d=new Date(b.ci);return d.getFullYear()===year&&d.getMonth()===i&&b.st!=='cancelled';});
    return{bks:bks.length,rev:bks.length*RATE,r1:bks.filter(b=>b.rm==1).length,r2:bks.filter(b=>b.rm==2).length};
  });
  const tot=monthly.reduce((s,m)=>s+m.bks,0);
  const rev=monthly.reduce((s,m)=>s+m.rev,0);
  const maxM=Math.max(...monthly.map(m=>m.bks),1);
  const bestI=monthly.findIndex(m=>m.bks===maxM);
  const worstI=monthly.reduce((bi,m,i)=>m.bks<monthly[bi].bks?i:bi,0);
  const canc=BK.filter(b=>new Date(b.ci).getFullYear()===year&&b.st==='cancelled').length;

  document.getElementById('rpt-kpis').innerHTML=[
    {label:'Total Revenue',val:`â‚±${rev.toLocaleString()}`,color:'sc-green'},
    {label:'Total Bookings',val:tot,color:'sc-amber'},
    {label:'Busiest Month',val:M3[bestI],color:'sc-blue'},
    {label:'Avg / Month',val:(tot/12).toFixed(1),color:'sc-purple'},
    {label:'Total Cancellations',val:canc,color:'sc-red'},
    {label:'Avg Revenue / Booking',val:`â‚±${tot?Math.round(rev/tot).toLocaleString():'0'}`,color:'sc-teal'},
  ].map(k=>`<div class="stat-card ${k.color}" style="min-height:auto;padding:1rem;">
    <div class="sc-val" style="font-size:1.4rem;">${k.val}</div>
    <div class="sc-label">${k.label} ${year}</div>
  </div>`).join('');

  document.getElementById('month-tbody').innerHTML=monthly.map((m,i)=>{
    const pct=Math.round((m.bks/maxM)*100)||0;
    return`<tr style="${i===bestI?'background:#FFFBEB;font-weight:600;':''}">
      <td>${i===bestI?'â­ ':''}<span style="font-size:.75rem;">${MFull[i]}</span></td>
      <td><span style="font-weight:700;">${m.bks}</span><div class="month-bar-mini"><div class="mbm-fill ${i===bestI?'mbm-amber':'mbm-green'}" style="width:${pct}%"></div></div></td>
      <td style="font-weight:${m.rev>0?'700':'400'};color:${m.rev>0?'var(--forest)':'var(--text4)'};">â‚±${m.rev.toLocaleString()}</td>
      <td style="font-size:.72rem;color:var(--text3);">${i===bestI?'<span style="color:var(--amber);font-weight:700;">ğŸ† Peak</span>':m.bks>0?`${m.r1} Â· ${m.r2} split`:'â€”'}</td>
    </tr>`;
  }).join('');

  document.getElementById('rpt-insights').innerHTML=[
    {tag:'ğŸ† Best Month',cls:'green',val:MFull[bestI],desc:`${monthly[bestI].bks} bookings Â· â‚±${monthly[bestI].rev.toLocaleString()} revenue. Analyze what made this month great and repeat it.`},
    {tag:'ğŸ’¡ Slowest Month',cls:'amber',val:MFull[worstI],desc:`${monthly[worstI].bks} bookings Â· â‚±${monthly[worstI].rev.toLocaleString()} revenue. Consider promos or discounts to boost this period.`},
    {tag:'ğŸ“Š Room Popularity',cls:'blue',val:`Suite ${monthly.reduce((s,m)=>s+m.r1,0)>=monthly.reduce((s,m)=>s+m.r2,0)?'1':'2'}`,desc:`Suite 1 had ${monthly.reduce((s,m)=>s+m.r1,0)} bookings Â· Suite 2 had ${monthly.reduce((s,m)=>s+m.r2,0)} bookings this year.`},
    {tag:'âš ï¸ Cancellations',cls:canc>3?'red':'amber',val:canc,desc:canc>0?`${canc} cancellation${canc>1?'s':''} this year. Follow up to understand why and reduce them.`:'No cancellations this year! Great job!'},
  ].map(k=>`<div class="insight-card ${k.cls}"><div class="insight-tag ${k.cls}">${k.tag}</div><div class="insight-val">${k.val}</div><div class="insight-desc">${k.desc}</div></div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GUESTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getUniqueGuests(){
  const map={};
  BK.forEach(b=>{
    const key=`${b.ph}`;
    if(!map[key]) map[key]={fn:b.fn,ln:b.ln,ph:b.ph,em:b.em||'',bookings:[]};
    map[key].bookings.push(b);
  });
  return Object.values(map).sort((a,b)=>b.bookings.length-a.bookings.length);
}
function renderGuests(){
  const list=getUniqueGuests();
  const wrap=document.getElementById('guest-list');
  wrap.innerHTML=list.map((g,i)=>`<div class="guest-card" onclick="showGuestDetail(${i})">
    <div class="guest-ava">${g.fn[0]}${g.ln[0]}</div>
    <div style="flex:1;min-width:0;">
      <div class="guest-nm">${g.fn} ${g.ln}</div>
      <div class="guest-det">${g.ph}${g.em?' Â· '+g.em:''}</div>
    </div>
    <div class="guest-stats">
      <div class="guest-stat-val">${g.bookings.filter(b=>b.st!=='cancelled').length}</div>
      <div class="guest-stat-lbl">stays</div>
    </div>
  </div>`).join('');
}
function filterGuests(){
  const q=(document.getElementById('guest-search')?.value||'').toLowerCase();
  const list=getUniqueGuests().filter(g=>`${g.fn} ${g.ln} ${g.ph}`.toLowerCase().includes(q));
  const wrap=document.getElementById('guest-list');
  wrap.innerHTML=list.map((g,i)=>`<div class="guest-card" onclick="showGuestDetail(${i})">
    <div class="guest-ava">${g.fn[0]}${g.ln[0]}</div>
    <div style="flex:1;min-width:0;">
      <div class="guest-nm">${g.fn} ${g.ln}</div>
      <div class="guest-det">${g.ph}</div>
    </div>
    <div class="guest-stats">
      <div class="guest-stat-val">${g.bookings.filter(b=>b.st!=='cancelled').length}</div>
      <div class="guest-stat-lbl">stays</div>
    </div>
  </div>`).join('');
}
function showGuestDetail(i){
  const guests=getUniqueGuests();
  const g=guests[i]; if(!g)return;
  const completed=g.bookings.filter(b=>b.st==='checkedout').length;
  const spent=g.bookings.filter(b=>b.st!=='cancelled').length*RATE;
  document.getElementById('guest-detail-title').textContent=`${g.fn} ${g.ln}`;
  document.getElementById('guest-detail').innerHTML=`
    <div style="display:flex;align-items:center;gap:1rem;margin-bottom:1.25rem;padding-bottom:1.1rem;border-bottom:1px solid var(--border);">
      <div style="width:52px;height:52px;border-radius:50%;background:linear-gradient(135deg,var(--forest),var(--sage));display:flex;align-items:center;justify-content:center;font-size:1.2rem;font-weight:800;color:#fff;flex-shrink:0;">${g.fn[0]}${g.ln[0]}</div>
      <div>
        <div style="font-size:1rem;font-weight:800;">${g.fn} ${g.ln}</div>
        <div style="font-size:.75rem;color:var(--text3);">ğŸ“ ${g.ph}${g.em?'  âœ‰ï¸ '+g.em:''}</div>
      </div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:.6rem;margin-bottom:1.1rem;">
      <div style="background:var(--linen);border-radius:.4rem;padding:.7rem;text-align:center;"><div style="font-size:1.2rem;font-weight:800;color:var(--forest);">${g.bookings.length}</div><div style="font-size:.62rem;color:var(--text3);">Total Bookings</div></div>
      <div style="background:var(--linen);border-radius:.4rem;padding:.7rem;text-align:center;"><div style="font-size:1.2rem;font-weight:800;color:var(--amber);">â‚±${spent.toLocaleString()}</div><div style="font-size:.62rem;color:var(--text3);">Total Spent</div></div>
      <div style="background:var(--linen);border-radius:.4rem;padding:.7rem;text-align:center;"><div style="font-size:1.2rem;font-weight:800;color:var(--sage);">${completed}</div><div style="font-size:.62rem;color:var(--text3);">Completed</div></div>
    </div>
    <div style="font-size:.72rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--text3);margin-bottom:.6rem;">Booking History</div>
    ${g.bookings.sort((a,b)=>new Date(b.ci)-new Date(a.ci)).map(b=>`<div onclick="openBkModal('${b.ref}')" style="display:flex;justify-content:space-between;align-items:center;padding:.6rem .8rem;border-radius:.4rem;border:1px solid var(--border);margin-bottom:.4rem;cursor:pointer;background:var(--snow);">
      <div><div style="font-size:.78rem;font-weight:600;">Suite ${b.rm}</div><div style="font-size:.68rem;color:var(--text3);">${fmtShort(b.ci)}</div></div>
      <div style="display:flex;align-items:center;gap:.5rem;">${pill(b.st)}<span style="font-size:.75rem;font-weight:700;color:var(--amber);">â‚±${RATE.toLocaleString()}</span></div>
    </div>`).join('')}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ROOM MANAGEMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderRoomsPage(){
  const now=new Date();
  [1,2].map(r=>{
    const occ=isOccupied(r,now);
    const cur=BK.find(b=>b.rm==r&&b.st!=='cancelled'&&now>=new Date(b.ci)&&now<new Date(b.co));
    const up=BK.filter(b=>b.rm==r&&b.st!=='cancelled'&&new Date(b.ci)>now).sort((a,b)=>new Date(a.ci)-new Date(b.ci)).slice(0,4);
    const names={1:'Sunset Suite',2:'Oceana Suite'};
    const panel=document.getElementById(`room${r}-panel`);
    panel.innerHTML=`
      <div class="panel-hd">
        <div class="panel-hd-left"><div class="ph-title">${r===1?'ğŸŒ…':'ğŸŒŠ'} Suite ${r} Â· ${names[r]}</div><div class="ph-sub">${r===1?'King Bed Â· 32 sqm':'Queen Bed Â· 30 sqm'} Â· Max 4 guests</div></div>
        <span class="pill ${occ?'p-occupied':'p-available'}">${occ?'Occupied':'Available'}</span>
      </div>
      <div class="panel-body">
        ${occ&&cur
          ?`<div style="background:var(--blue-lt);border:1px solid #93C5FD;border-radius:.5rem;padding:.9rem;margin-bottom:1rem;">
              <div style="font-size:.62rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--blue);margin-bottom:.35rem;">Currently Staying</div>
              <div style="font-weight:700;font-size:.88rem;">${cur.fn} ${cur.ln}</div>
              <div style="font-size:.73rem;color:var(--text2);">ğŸ“ ${cur.ph} Â· ğŸ‘¥ ${cur.px} guests</div>
              <div style="font-size:.72rem;color:var(--text3);margin-top:.2rem;">Check-out: ${fmtFull(cur.co)}</div>
              ${cur.nt?`<div style="font-size:.7rem;font-style:italic;margin-top:.2rem;">"${cur.nt}"</div>`:''}
              <button class="btn btn-sm" style="margin-top:.5rem;background:var(--blue-lt);color:var(--blue);border:1px solid #93C5FD;" onclick="openBkModal('${cur.ref}')">View Booking â†’</button>
            </div>`
          :`<div style="background:var(--green-lt);border:1px solid #86EFAC;border-radius:.5rem;padding:.8rem;margin-bottom:1rem;font-size:.8rem;color:var(--green);font-weight:600;">âœ“ Room is clean and ready for guests</div>`
        }
        <div style="font-size:.68rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--text3);margin-bottom:.5rem;">Upcoming (next 4)</div>
        ${up.length?up.map(b=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:.55rem 0;border-bottom:1px solid var(--linen);cursor:pointer;" onclick="openBkModal('${b.ref}')">
          <div><div style="font-size:.8rem;font-weight:600;">${b.fn} ${b.ln}</div><div style="font-size:.7rem;color:var(--text3);">${fmtShort(b.ci)} Â· ${b.px} guests</div></div>
          ${pill(b.st)}
        </div>`).join(''):`<div style="font-size:.78rem;color:var(--text3);font-style:italic;">No upcoming reservations</div>`}
      </div>`;
  });
}
function saveRoom(r){showToast(`Suite ${r} details saved!`,'âœ…','t-ok');addLog('ok',`Suite ${r} details updated`);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PRICING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function savePricing(){showToast('Pricing saved!','âœ…','t-ok');addLog('ok','Pricing settings updated');}
function savePolicies(){showToast('Policies saved!','âœ…','t-ok');addLog('ok','Booking policies updated');}

function renderBlockedDates(){
  const wrap=document.getElementById('blocked-dates-list'); if(!wrap)return;
  if(!blockedDates.length){wrap.innerHTML=`<div style="font-size:.78rem;color:var(--text3);font-style:italic;margin-bottom:.75rem;">No blocked dates added yet.</div>`;return;}
  wrap.innerHTML=blockedDates.map((bd,i)=>`<div style="display:flex;align-items:center;gap:.75rem;padding:.55rem .75rem;background:var(--red-lt);border:1px solid #FCA5A5;border-radius:.4rem;margin-bottom:.45rem;">
    <div style="flex:1;font-size:.8rem;"><strong>${bd.date}</strong> â€” Suite ${bd.rm==='both'?'1 & 2':bd.rm} <span style="color:var(--text3);">(${bd.reason||'No reason'})</span></div>
    <button class="btn btn-sm btn-danger" onclick="removeBlockedDate(${i})">Remove</button>
  </div>`).join('');
}
function addBlockedDate(){
  const f=document.getElementById('blocked-date-form');
  f.style.display=bdFormVisible?'none':'flex';
  bdFormVisible=!bdFormVisible;
}
function saveBlockedDate(){
  const date=g('bd-date')?.value,rm=g('bd-rm')?.value,reason=g('bd-reason')?.value;
  if(!date)return;
  blockedDates.push({date,rm,reason}); saveAll(); renderBlockedDates();
  if(g('bd-date')) g('bd-date').value='';
  if(g('bd-reason')) g('bd-reason').value='';
  showToast('Date blocked successfully','âœ…','t-ok');
}
function removeBlockedDate(i){blockedDates.splice(i,1);saveAll();renderBlockedDates();}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchStab(idx,el){
  document.querySelectorAll('.stab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.stab-pane').forEach(p=>p.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('stab-'+idx).classList.add('active');
}
function saveSettings(){
  CFG.propName=g('s-propname')?.value||'';
  CFG.phone=g('s-phone')?.value||'';
  CFG.email=g('s-email')?.value||'';
  CFG.fb=g('s-fb')?.value||'';
  CFG.addr=g('s-addr')?.value||'';
  saveAll(); showToast('Property info saved!','âœ…','t-ok'); addLog('ok','Property settings saved');
}
function saveAccount(){
  const name=g('s-name')?.value||'Admin';
  const pw1=g('s-pw-new')?.value,pw2=g('s-pw-conf')?.value;
  if(pw1&&pw1!==pw2){showToast('Passwords do not match','âš ï¸','t-err');return;}
  CFG.adminName=name; saveAll();
  document.getElementById('admin-display-name').textContent=name;
  showToast('Account settings saved!','âœ…','t-ok'); addLog('ok','Admin account updated');
}
function savePolicies(){showToast('Policies saved!','âœ…','t-ok');addLog('ok','Booking policies updated');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DATA EXPORT / IMPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function exportCSV(){
  const rows=[['Ref','First Name','Last Name','Phone','Email','Suite','Check-in','Check-out','Pax','Total','Payment','Status','Notes','Created']];
  BK.forEach(b=>rows.push([b.ref,b.fn,b.ln,b.ph,b.em||'','Suite '+b.rm,fmtFull(b.ci),fmtFull(b.co),b.px,RATE,b.pay||'',b.st,b.nt||'',b.created?fmtFull(b.created):'']));
  const csv=rows.map(r=>r.map(c=>`"${String(c||'').replace(/"/g,'""')}"`).join(',')).join('\n');
  dlFile(`espacio-norte-bookings-${new Date().toISOString().slice(0,10)}.csv`,'data:text/csv;charset=utf-8,'+encodeURIComponent(csv));
  showToast('CSV exported!','ğŸ“¥','t-ok'); addLog('ok','Bookings exported to CSV');
}
function exportCSVMonth(){
  const now=new Date();
  const month=BK.filter(b=>{const d=new Date(b.ci);return d.getMonth()===now.getMonth()&&d.getFullYear()===now.getFullYear();});
  if(!month.length){showToast('No bookings this month to export','â„¹ï¸');return;}
  const rows=[['Ref','Guest','Suite','Check-in','Check-out','Pax','Total','Status']];
  month.forEach(b=>rows.push([b.ref,`${b.fn} ${b.ln}`,'Suite '+b.rm,fmtFull(b.ci),fmtFull(b.co),b.px,RATE,b.st]));
  const csv=rows.map(r=>r.map(c=>`"${String(c||'').replace(/"/g,'""')}"`).join(',')).join('\n');
  dlFile(`espacio-norte-${MFull[now.getMonth()]}-${now.getFullYear()}.csv`,'data:text/csv;charset=utf-8,'+encodeURIComponent(csv));
  showToast('Monthly CSV exported!','ğŸ“¥','t-ok');
}
function importData(){
  try{
    const raw=g('import-data')?.value.trim();
    if(!raw)return;
    const data=JSON.parse(raw);
    if(!Array.isArray(data)){showToast('Invalid format â€” must be a JSON array','âŒ','t-err');return;}
    if(!confirm(`Import ${data.length} records? Existing data will be merged.`))return;
    const existingRefs=new Set(BK.map(b=>b.ref));
    const newOnes=data.filter(b=>!existingRefs.has(b.ref));
    BK.push(...newOnes); saveAll(); renderAll();
    showToast(`Imported ${newOnes.length} new records!`,'âœ…','t-ok');
    addLog('ok',`Imported ${newOnes.length} booking records`);
  }catch(e){showToast('Import failed â€” invalid JSON','âŒ','t-err');}
}
function clearCancelled(){
  if(!confirm('Delete all cancelled bookings? This cannot be undone.'))return;
  const before=BK.length; BK=BK.filter(b=>b.st!=='cancelled');
  saveAll(); renderAll();
  showToast(`Deleted ${before-BK.length} cancelled bookings`,'ğŸ—‘ï¸','t-warn');
  addLog('warn',`${before-BK.length} cancelled bookings deleted`);
}
function clearAllData(){
  if(!confirm('âš ï¸ Delete ALL data permanently?'))return;
  if(!confirm('This cannot be undone. Confirm?'))return;
  localStorage.removeItem(BK_KEY); BK=[]; LOG=[]; saveAll(); renderAll();
  showToast('All data cleared','âš ï¸','t-warn');
}
function dlFile(name,data){const a=document.createElement('a');a.href=data;a.download=name;a.click();}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ACTIVITY LOG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addLog(type,msg){
  LOG.unshift({type,msg,time:new Date().toISOString()});
  if(LOG.length>200) LOG=LOG.slice(0,200);
  saveAll(); renderActivityLog();
}
function renderActivityLog(){
  const wrap=document.getElementById('activity-log'); if(!wrap)return;
  if(!LOG.length){wrap.innerHTML=`<div class="empty"><div class="empty-ico">ğŸ•</div><p>No activity yet</p></div>`;return;}
  const colors={ok:'log-ld-green',warn:'log-ld-amber',err:'log-ld-red',info:'log-ld-blue'};
  wrap.innerHTML=LOG.map(l=>`<div class="log-item">
    <div class="log-dot ${colors[l.type]||'log-ld-blue'}"></div>
    <div class="log-msg">${l.msg}</div>
    <div class="log-time">${fmtAgo(l.time)}</div>
  </div>`).join('');
}
function clearLog(){if(!confirm('Clear activity log?'))return;LOG=[];saveAll();renderActivityLog();}
function fmtAgo(iso){
  const diff=(Date.now()-new Date(iso))/1000;
  if(diff<60) return 'just now';
  if(diff<3600) return `${Math.round(diff/60)}m ago`;
  if(diff<86400) return `${Math.round(diff/3600)}h ago`;
  return new Date(iso).toLocaleDateString('en-PH',{month:'short',day:'numeric'});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NOTIFICATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addNotif(msg,type='info'){
  notifs.unshift({msg,type,time:new Date().toISOString(),read:false});
  renderNotifs();
}
function renderNotifs(){
  const wrap=document.getElementById('notif-list'); if(!wrap)return;
  const dot=document.getElementById('notif-dot');
  const unread=notifs.filter(n=>!n.read).length;
  dot.style.display=unread>0?'block':'none';
  if(!notifs.length){wrap.innerHTML=`<div style="padding:1.2rem;text-align:center;font-size:.8rem;color:var(--text3);">No notifications</div>`;return;}
  const cols={green:'var(--sage)',red:'var(--red)',amber:'var(--amber)',info:'var(--blue)'};
  wrap.innerHTML=notifs.slice(0,8).map(n=>`<div class="notif-item${!n.read?' unread':''}">
    <div class="notif-item-title">${n.msg}</div>
    <div class="notif-item-time">${fmtAgo(n.time)}</div>
  </div>`).join('');
}
function toggleNotifs(){
  document.getElementById('notif-panel').classList.toggle('open');
  notifs.forEach(n=>n.read=true); renderNotifs();
}
function clearNotifs(){notifs=[];renderNotifs();document.getElementById('notif-panel').classList.remove('open');}
document.addEventListener('click',e=>{if(!document.getElementById('notif-btn').contains(e.target))document.getElementById('notif-panel').classList.remove('open');});

function renderPendingBadge(){
  const n=BK.filter(b=>b.st==='pending').length;
  const b=document.getElementById('sb-pending-badge');
  b.textContent=n; b.style.display=n>0?'inline':'none';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let toastTimer;
function showToast(msg,ico='â„¹ï¸',cls=''){
  const t=document.getElementById('toast');
  document.getElementById('toast-ico').textContent=ico;
  document.getElementById('toast-msg').textContent=msg;
  t.className='toast show '+(cls||'');
  clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>t.classList.remove('show'),3500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function g(id){return document.getElementById(id);}
function setText(id,v){const el=document.getElementById(id);if(el)el.textContent=v;}
function isOccupied(rm,dt){return BK.some(b=>{if(b.rm!=rm||b.st==='cancelled')return false;return dt>=new Date(b.ci)&&dt<new Date(b.co);});}
function fmtFull(iso){return new Date(iso).toLocaleString('en-PH',{month:'short',day:'numeric',year:'numeric',hour:'2-digit',minute:'2-digit'});}
function fmtShort(iso){return new Date(iso).toLocaleString('en-PH',{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});}
function fmtTime(iso){return new Date(iso).toLocaleTimeString('en-PH',{hour:'2-digit',minute:'2-digit'});}
function pill(st){
  const m={confirmed:'p-confirmed Confirmed',pending:'p-pending Pending',checkedin:'p-checkedin Checked In',checkedout:'p-checkedout Checked Out',cancelled:'p-cancelled Cancelled'};
  const [cls,lbl]=(m[st]||'p-pending '+st).split(' ',2);
  return `<span class="pill ${cls}">${lbl||st}</span>`;
}
function logout(){if(confirm('Log out of admin panel?'))showToast('Logged out','ğŸ‘‹');}
function setTopbarDate(){
  const d=new Date();
  const el=document.getElementById('today-label');
  if(el) el.textContent=d.toLocaleDateString('en-PH',{weekday:'short',month:'long',day:'numeric',year:'numeric'});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  START
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
init();
// Set default new booking date
const defDt=new Date();defDt.setHours(14,0,0,0);
const nbCi=g('nb-ci');if(nbCi)nbCi.value=defDt.toISOString().slice(0,16);
</script>
</body>
</html>